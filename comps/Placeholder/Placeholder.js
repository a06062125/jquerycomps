(function(c){JC.Placeholder=a;function a(d){d&&(d=c(d));if(a.isSupport){d&&d.is("[xplaceholder]")&&d.attr("placeholder",d.attr("xplaceholder"));return}if(a.getInstance(d)){return a.getInstance(d)}a.getInstance(d,this);this._model=new a.Model(d);this._view=new a.View(this._model);this._init();JC.log("Placeholder:",new Date().getTime())}a.getInstance=function(d,e){if(typeof d=="string"&&!/</.test(d)){d=c(d)}if(!(d&&d.length)||(typeof d=="string")){return}typeof e!="undefined"&&d.data(a.Model._instanceName,e);return d.data(a.Model._instanceName)};a.init=function(e){var f=[],d;a.update();e=c(e||document);if(e&&e.length&&(d=e.prop("nodeName").toLowerCase())){if(d=="text"||d=="textarea"){if(a.isSupport){e.is("[xplaceholder]")&&e.attr("placeholder",e.attr("xplaceholder"))}else{e.is("[placeholder]")&&f.push(new a(e))}}else{e.find(["input[type=text][placeholder]","textarea[placeholder]","input[type=text][xplaceholder]","textarea[xplaceholder]"].join(",")).each(function(){var g=c(this);if(a.isSupport){g.is("[xplaceholder]")&&g.attr("placeholder",g.attr("xplaceholder"))}else{f.push(new a(g))}})}}return f};a.update=function(){var d=c(printf("#{0} > div",a.Model._boxId));if(!d.length){return}d.each(function(){var e=c(this),f=e.data("CPHIns");if(!f){return}f.update()})};a.className="xplaceholder";a.isSupport="placeholder" in c('<input type="text" />')[0];a.prototype={_beforeInit:function(){},_initHanlderEvent:function(){var d=this;d._model.selector().on("focus",function(e){d._view.hide()});d._model.selector().on("blur",function(e){d._view.show()});d._model.selector().on("placeholder_remove",function(e){d._model.placeholder().remove();a.Model._removeTm&&clearTimeout(a.Model._removeTm);a.Model._removeTm=setTimeout(function(){a.update()},1)});d.on("CPHUpdate",function(e){d._view.update()});d.on("CPHInitedPlaceholder",function(e){var f=d._model.placeholder();f.on("click",function(g){d._model.selector().trigger("focus");b(d._model.selector()[0],d._model.selector().val().length)});f.data("CPHIns",d)})},_inited:function(){var d=c(this);d.trigger("CPHUpdate")},update:function(){this._view.update()}};BaseMVC.buildModel(a);a.Model._instanceName="Placeholder";a.Model._boxId="XPlaceHolderBox";a.Model.prototype={init:function(){},className:function(){var d=this.attrProp("cphClassName")||a.className;return d},text:function(){var d=this.attrProp("xplaceholder")||this.attrProp("placeholder")||"";return d},placeholder:function(){if(!this._placeholder){this._placeholder=c(printf('<div class="{0}"></div>',this.className())).appendTo(this.placeholderBox());c(this).trigger("TriggerEvent",["CPHInitedPlaceholder"])}this._placeholder.html(this.text());return this._placeholder},placeholderBox:function(){var d=c("#"+a.Model._boxId);if(!(d&&d.length)){d=c(printf('<div id="{0}"></div>',a.Model._boxId)).appendTo(document.body)}return d}};BaseMVC.buildView(a);a.View.prototype={init:function(){},update:function(){var d=this,f=d._model.selector().val().trim(),h=d._model.placeholder();if(f){h.hide();return}var e=d._model.selector().offset(),g=d._model.selector().prop("offsetHeight"),i=h.prop("offsetHeight");h.css({left:e.left+"px",top:e.top+1+"px","line-height":g+"px"});h.show()},hide:function(){var d=this;d._model.placeholder().hide()},show:function(){var d=this,e=d._model.selector().val().trim();if(e){return}this.update();d._model.placeholder().show()}};BaseMVC.build(a);c.event.special.placeholder_remove={remove:function(d){if(d.handler){d.handler()}}};c(window).on("resize",function(){a.update()});function b(d,l){if(d.setSelectionRange){d.focus();d.setSelectionRange(l,l)}else{if(d.createTextRange){var m=d.createTextRange();var f=l;var j=l;var e=0;var g=0;var n=d.value;for(var h=0;h<n.length&&h<f;h++){var k=n.charAt(h);if(k!="\n"){e++}}for(var h=n.length-1;h>=j&&h>=0;h--){var k=n.charAt(h);if(k!="\n"){g++}}m.moveStart("character",e);m.moveEnd("character",-g);m.select();d.focus()}}}c(document).ready(function(){var d=0;a.autoInit&&(d=a.init())})}(jQuery));