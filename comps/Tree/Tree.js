(function(f){window.Tree=JC.Tree=e;function e(b,a){if(b&&f(b).length){b=f(b);if(e.getInstance(b)){return e.getInstance(b)}b.data("TreeIns",this)}this._model=new g(b,a);this._view=new h(this._model)}e.getInstance=function(a){a=f(a);return a.data("TreeIns")};e.dataFilter;e.prototype={init:function(){this._view.init();this._view.treeRoot().data("TreeIns",this);return this},open:function(a){if(typeof a=="undefined"){this._view.openAll();return this}this._view.open(a);return this},close:function(a){if(typeof a=="undefined"){this._view.closeAll();return this}this._view.close(a);return this},idPrefix:function(){return this._model.idPrefix()},getItem:function(b){var a;b&&(a=f("#"+this._model.id(b)));return a},on:function(a,b){if(!(a&&b)){return this}this._model.addEvent(a,b);return this},event:function(a){if(!a){return}return this._model.event(a)},highlight:function(a){return this._model.highlight(a)}};function g(b,a){this._container=b;this._data=a;this._id="tree_"+new Date().getTime()+"_";this._highlight;this._events={};this._init()}g.prototype={_init:function(){e.dataFilter&&(this._data=e.dataFilter(this._data));return this},container:function(){return this._container},id:function(a){return this._id+a},idPrefix:function(){return this._id},data:function(){return this._data},root:function(){return this._data.root},child:function(a){return this._data.data[a]},hasChild:function(a){return a in this._data.data},event:function(a){a=a.toLowerCase();return this._events[a]},addEvent:function(a,b){a=a.toLowerCase();if(!(a in this._events)){this._events[a]=[]}this._events[a].unshift(b)},highlight:function(a){a&&(this._highlight=a);return this._highlight}};function h(a){this._model=a;this._treeRoot}h.prototype={init:function(){if(!(this._model.data()&&this._model.root())){return}this._process(this._model.child(this._model.root()[0]),this._initRoot());return this},treeRoot:function(a){a&&(this._treeRoot=a);return this._treeRoot},_process:function(b,a){for(var c=0,i=b.length,d,j;c<i;c++){d=b[c];j=c===i-1;if(this._model.hasChild(d[0])){this._initFolder(a,d,j)}else{this._initFile(a,d,j)}}},_initRoot:function(){var l=this;if(!l._model.data().root){return}var d=l._model.data().root;var a=f('<ul class="tree_wrap"></ul>');var b=this._initLabel(d);var k=f('<li class="folder_open"></li>');k.html('<span class="folder_img_root folderRoot folder_img_open">&nbsp;</span>');b.appendTo(k);k.appendTo(a);a.appendTo(l._model.container());this.treeRoot(a);var c=f('<ul style="" class="tree_wrap_inner"></ul>');c.appendTo(k);return c},_initFolder:function(a,m,p){var n="",d="";p&&(n="folder_span_lst ",d="folder_last");var b=this._initLabel(m);var o=f(printf('<li><span class="folder_img_closed folder {1}">&nbsp;</span></li>',m[1],n));o.addClass(printf("folder_closed {0} folder",d));b.appendTo(o);var c=f('<ul style="display:none;" class="folder_ul_lst" ></ul>');c.appendTo(o);o.appendTo(a);this._process(this._model.child(m[0]),c)},_initFile:function(a,d,n){var l="folder_img_bottom ",c="";n&&(l="folder_img_last ",c="");var b=this._initLabel(d);var m=f(printf('<li><span class="{1}file">&nbsp;</span></li>',d[1],l));m.addClass("folder_closed file");b.appendTo(m);m.appendTo(a)},_initLabel:function(b){var a=f('<div class="node_ctn"></div>');a.attr("id",this._model.id(b[0])).attr("dataid",b[0]).attr("dataname",b[1]).data("nodeData",b);if(this._model.event("RenderLabel")){f.each(this._model.event("RenderLabel"),function(c,d){if(d.call(a,b,a)===false){return false}})}else{a.html(b[1]||"没有标签")}return a},openAll:function(){if(!this.treeRoot()){return}this.treeRoot().find("span.folder_img_closed").each(function(){f(this).trigger("click")})},closeAll:function(){if(!this.treeRoot()){return}this.treeRoot().find("span.folder_img_open, span.folder_img_root").each(function(){if(f(this).hasClass("folder_img_closed")){return}f(this).trigger("click")})},open:function(b){if(!b){return}var c=f("#"+this._model.id(b));if(!c.length){return}var a=c.parents("li");if(this._model.highlight()){this._model.highlight().removeClass("highlight")}c.addClass("highlight");this._model.highlight(c);a.each(function(){var j=f(this),d=j.find("> span.folderRoot, > span.folder");if(d.length){if(d.hasClass("folder_img_open")){return}d.trigger("click")}})},close:function(b){if(!b){return}var c=f("#"+this._model.id(b));if(!c.length){return}var a=c.parent("li").find("> span.folderRoot, > span.folder");if(a.length){if(a.hasClass("folder_img_closed")){return}a.trigger("click")}}};e.lastHover=null;f(document).delegate("ul.tree_wrap div.node_ctn","mouseenter",function(){if(e.lastHover){e.lastHover.removeClass("ms_over")}f(this).addClass("ms_over");e.lastHover=f(this)});f(document).delegate("ul.tree_wrap div.node_ctn","mouseleave",function(){if(e.lastHover){e.lastHover.removeClass("ms_over")}});f(document).delegate("ul.tree_wrap div.node_ctn","click",function(d){var j=f(this),b=j.parents("ul.tree_wrap"),a=b.data("TreeIns");if(!a){return}var c=a.event("click");if(c&&c.length){f.each(c,function(i,l){if(l.call(j,d)===false){return false}})}if(a.highlight()){a.highlight().removeClass("highlight")}j.addClass("highlight");a.highlight(j);var c=a.event("change");if(c&&c.length){f.each(c,function(i,l){if(l.call(j,d)===false){return false}})}});f(document).delegate("ul.tree_wrap span.folder, ul.tree_wrap span.folderRoot","click",function(m){var n=f(this),l=n.parent("li"),a=l.find("> ul");var c=n.parents("ul.tree_wrap"),b=c.data("TreeIns");var d=b.event("FolderClick");if(d&&d.length){f.each(d,function(i,j){if(j.call(n,m)===false){return false}})}if(n.hasClass("folder_img_open")){n.removeClass("folder_img_open").addClass("folder_img_closed");a.hide()}else{if(n.hasClass("folder_img_closed")){n.addClass("folder_img_open").removeClass("folder_img_closed");a.show()}}if(l.hasClass("folder_closed")){l.addClass("folder_open").removeClass("folder_closed")}else{if(l.hasClass("folder_open")){l.removeClass("folder_open").addClass("folder_closed")}}})}(jQuery));