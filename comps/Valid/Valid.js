(function(e){JC.Valid=window.Valid=f;function f(){var a=sliceArgs(arguments);if(a.length){return f.check.apply(null,a)}if(f._instance){return f._instance}f._instance=this;this._model=new g();this._view=new h(this._model);this._init()}f.prototype={_init:function(){var a=this;e([this._view,this._model]).on(g.BIND,function(d,b,c){a.on(b,c)});e([this._view,this._model]).on(g.TRIGGER,function(d,b){var c=sliceArgs(arguments).slice(2);a.trigger(b,c)});a.on(g.CORRECT,function(c){var b=sliceArgs(arguments).slice(1);a._view.valid.apply(a._view,b)});a.on(g.ERROR,function(c){var b=sliceArgs(arguments).slice(1);a._view.error.apply(a._view,b)});a.on("FocusMsg",function(c){var b=sliceArgs(arguments).slice(1);a._view.focusmsg.apply(a._view,b)});this._view.init();return this},on:function(a,b){e(this).on(a,b);return this},trigger:function(a,b){e(this).trigger(a,b);return this},parse:function(){var c=this,a=true,b=sliceArgs(arguments);e.each(b,function(d,j){j=e(j);j.each(function(){var n=e(this);if(!c._model.isAvalible(n)){return}if(!c._model.isValid(n)){return}if(f.ignore(n)){return}var p=c._model.parseDatatype(n),o=n.prop("nodeName").toLowerCase();switch(o){case"input":case"textarea":(n.attr("type")||"").toLowerCase()!="file"&&c._model.isAutoTrim(n)&&n.val(e.trim(n.val()));break}if(!c._model.reqmsg(n)){a=false;return}if(!c._model.lengthValid(n)){a=false;return}if(p&&c._model[p]&&n.val()){if(!c._model[p](n)){a=false;return}}var i=n.attr("subdatatype");if(i){i=i.replace(/[\s]+/g,"").split(/[,\|]/);e.each(i,function(l,k){k=c._model.parseSubdatatype(k);if(k&&c._model[k]&&(n.val()||k=="alternative")){if(!c._model[k](n)){a=false;return false}}});if(!a){return}}c.trigger(g.CORRECT,n)})});return a},check:function(){var i=this,a=true,b=sliceArgs(arguments),c,d;e.each(b,function(k,p){p=e(p);if(i._model.isForm(p)){var o=i._model.isErrorAbort(p),q;for(c=0,d=p[0].length;c<d;c++){var r=e(e(p[0][c]));if(!i._model.isValid(r)){continue}!i.parse(r)&&(a=false);if(o&&!a){break}}}else{if(f.isFormControl(p)){if(!i._model.isValid(p)){return}!i.parse(p)&&(a=false)}else{!i.check(p.find(f._formControls))&&(a=false)}}});return a},clearError:function(){var a=sliceArgs(arguments),b=this;e.each(a,function(c,d){e(d).each(function(){var i=e(this);switch(i.prop("nodeName").toLowerCase()){case"form":for(var j=0,n=i[0].length;j<n;j++){f.setValid(e(i[0][j]),1,true)}break;default:f.setValid(i,1,true);break}})});return this},isValid:function(a){return this._model.isValid(a)},formHasValue:function(n,c){var a=false,d,b;n&&(n=e(n));if(n&&n.length){for(var i=0,j=n[0].length;i<j;i++){d=e(n[0][i]);if(d.is("[disabled]")){continue}b=d.prop("nodeName").toLowerCase();if(c&&d.is(c)){continue}switch(d.prop("type").toLowerCase()){case"select-multiple":case"select-one":case"select":case"file":case"textarea":case"password":case"hidden":case"text":if(e.trim(d.val()).length){return true}break;case"checkbox":case"radio":if(d.prop("checked")){return true}break}}}return a}};f.checkAll=f.check=function(){return f.getInstance().check.apply(f.getInstance(),sliceArgs(arguments))};f.getInstance=function(){!f._instance&&new f();return f._instance};f.isValid=function(a){return f.getInstance().isValid(a)};f.setValid=function(b,a){return f.getInstance().trigger(g.CORRECT,sliceArgs(arguments))};f.setError=function(a,b,c){if(b&&b.trim()&&/^[\s]/.test(b)){var d="autoGenerateErrorMsg";a.attr(d,b);b=d}return f.getInstance().trigger(g.ERROR,sliceArgs(arguments))};f.focusmsg=function(b,a){return f.getInstance().trigger("FocusMsg",sliceArgs(arguments))};f.focusmsgEverytime=true;f.emDisplayType="inline";f.showValidStatus=false;f.clearError=function(){return f.getInstance().clearError.apply(f.getInstance(),sliceArgs(arguments))};f.errorAbort=false;f.autoTrim=true;f.itemCallback;f.formHasValue=function(){return f.getInstance().formHasValue.apply(f.getInstance(),sliceArgs(arguments))};f.ignore=function(c,a){c=e(c);if(!(c&&c.length)){return true}var b=false;if(typeof a!="undefined"){a?c.removeAttr("ignoreprocess"):c.attr("ignoreprocess",true);b=a}else{c.is("[ignoreprocess]")&&((c.attr("ignoreprocess")||"").trim()?(b=parseBool(c.attr("ignoreprocess"))):(b=true))}return b};f._formControls="input, select, textarea";f.isFormControl=function(b){var a=false;b&&(b=e(b)).length&&(a=b.is(f._formControls));return a};function g(){this._init()}g.TRIGGER="TriggerEvent";g.BIND="BindEvent";g.ERROR="ValidError";g.CORRECT="ValidCorrect";g.SELECTOR_ERROR="~ em.error, ~ em.errormsg";g.CSS_ERROR="error errormsg";g.FILTER_ERROR="em.error em.errormsg";g.prototype={_init:function(){return this},parseDatatype:function(b){var a="";if(typeof b=="string"){a=b}else{a=b.attr("datatype")||"text"}return a.toLowerCase().replace(/\-.*/,"")},parseSubdatatype:function(b){var a="";if(typeof b=="string"){a=b}else{a=b.attr("subdatatype")||""}return a.toLowerCase().replace(/\-.*/,"")},isAvalible:function(a){return a.is(":visible")&&!a.is("[disabled]")},isForm:function(b){var a;b.prop("nodeName")&&b.prop("nodeName").toLowerCase()=="form"&&(a=true);return a},isErrorAbort:function(b){var a=f.errorAbort;b.is("[errorabort]")&&(a=parseBool(b.attr("errorabort")));return a},isValid:function(c){c=e(c);var a,b;c.each(function(){b=e(this);if(b.is("[datatype]")||b.is("[subdatatype]")||b.is("[minlength]")||b.is("[maxlength]")||b.is("[reqmsg]")||b.is("form")){a=true}});return a},isAutoTrim:function(b){b=e(b);var a=f.autoTrim,c=getJqParent(b,"form");c&&c.length&&c.is("[validautotrim]")&&(a=parseBool(c.attr("validautotrim")));b.is("[validautotrim]")&&(a=parseBool(b.attr("validautotrim")));return a},isReqmsg:function(a){return a.is("[reqmsg]")},isValidMsg:function(b){b=e(b);var a=f.showValidStatus,c=getJqParent(b,"form");c&&c.length&&c.is("[validmsg]")&&(a=parseBool(c.attr("validmsg")));b.is("[validmsg]")&&(a=parseBool(b.attr("validmsg")));return a},validitemcallback:function(c){c=e(c);var a=f.itemCallback,d=getJqParent(c,"form"),b;d&&d.length&&d.is("[validitemcallback]")&&(b=d.attr("validitemcallback"))&&(b=window[b])&&(a=b);c.is("[validitemcallback]")&&(b=c.attr("validitemcallback"))&&(b=window[b])&&(a=b);return a},isMinlength:function(a){return a.is("[minlength]")},isMaxlength:function(a){return a.is("[maxlength]")},minlength:function(a){return parseInt(a.attr("minlength"),10)||0},maxlength:function(a){return parseInt(a.attr("maxlength"),10)||0},isMinvalue:function(a){return a.is("[minvalue]")},isMaxvalue:function(a){return a.is("[maxvalue]")},isDatatarget:function(d,c){var a=false,b="datatarget";c&&(c+=b)&&(a=d.is("["+c+"]"));!a&&(a=d.is("["+b+"]"));return a},datatarget:function(d,c){var a,b="datatarget";c&&(c+=b)&&(c=d.attr(c))&&(a=parentSelector(d,c));!(a&&a.length)&&(a=parentSelector(d,d.attr(b)));return a},minvalue:function(c,a){if(typeof a=="string"){var b=a.toLowerCase().trim();switch(b){default:return parseISODate(c.attr("minvalue"))}}else{if(a){return parseFloat(c.attr("minvalue"))||0}else{return parseInt(c.attr("minvalue"),10)||0}}},maxvalue:function(c,a){if(typeof a=="string"){var b=a.toLowerCase().trim();switch(b){default:return parseISODate(c.attr("maxvalue"))}}else{if(a){return parseFloat(c.attr("maxvalue"))||0}else{return parseInt(c.attr("maxvalue"),10)||0}}},lengthValid:function(d){var o=this,b=true,d=e(d),p=o.parseDatatype(d),c,m,a=e.trim(d.val()),n;if(!a){return b}o.isMinlength(d)&&(c=o.minlength(d));o.isMaxlength(d)&&(m=o.maxlength(d));switch(p){case"bytetext":n=o.bytelen(a);break;case"richtext":default:n=a.length;break}c&&(n<c)&&(b=false);m&&(n>m)&&(b=false);JC.log("lengthValid: ",c,m,b,a.length);!b&&e(o).trigger(g.TRIGGER,[g.ERROR,d]);return b},n:function(d,t){var v=this,a=true,c=d.val(),s=+c,q=0,b=Math.pow(10,10),u,r,p;v.isMinvalue(d)&&(q=v.minvalue(d,/\./.test(d.attr("minvalue")))||q);if(!isNaN(s)&&s>=q){d.attr("datatype").replace(/^n[^\-]*\-(.*)$/,function(i,j){p=j.split(".");u=p[0];r=p[1]});v.isMaxvalue(d)&&(b=v.maxvalue(d,/\./.test(d.attr("maxvalue")))||b);if(s>=q&&s<=b){typeof u!="undefined"&&typeof r!="undefined"&&(a=new RegExp("^(?:-|)(?:[\\d]{0,"+u+"}|)(?:\\.[\\d]{1,"+r+"}|)$").test(c));typeof u!="undefined"&&typeof r=="undefined"&&(a=new RegExp("^(?:-|)[\\d]{1,"+u+"}$").test(c));typeof u=="undefined"&&typeof r!="undefined"&&(a=new RegExp("^(?:-|)\\.[\\d]{1,"+r+"}$").test(c));typeof r=="undefined"&&/\./.test(c)&&(a=false)}else{a=false}}else{a=false}!a&&!t&&e(v).trigger(g.TRIGGER,[g.ERROR,d]);return a},nrange:function(n){var p=this,a=p.n(n),m,o,b,c,d;if(a){if(n.is("[fromNEl]")){b=p.getElement(n.attr("fromNEl"),n);c=n}if(n.is("[toNEl]")){b=n;c=p.getElement(n.attr("toNEl"),n)}if(!(b&&b.length||c&&c.length)){d=p.sametypeitems(n);if(d.length>=2){b=e(d[0]);c=e(d[1])}}if(b&&b.length||c&&c.length){JC.log("nrange",b.length,c.length);c.val(e.trim(c.val()));b.val(e.trim(b.val()));if(c[0]!=b[0]&&c.val().length&&b.val().length){a&&(a=p.n(c,true));a&&(a=p.n(b,true));a&&(+b.val())>(+c.val())&&(a=false);JC.log("nrange:",+b.val(),+c.val(),a);a&&e(p).trigger(g.TRIGGER,[g.CORRECT,b]);a&&e(p).trigger(g.TRIGGER,[g.CORRECT,c]);!a&&e(p).trigger(g.TRIGGER,[g.ERROR,b]);!a&&e(p).trigger(g.TRIGGER,[g.ERROR,c]);return a}}}return a},d:function(d,m){var n=this,a=e.trim(d.val()),c=true,l=parseISODate(a),b;if(a&&l){if(n.isMinvalue(d)&&(b=n.minvalue(d,"d"))){l.getTime()<b.getTime()&&(c=false)}if(c&&n.isMaxvalue(d)&&(b=n.maxvalue(d,"d"))){l.getTime()>b.getTime()&&(c=false)}}!c&&!m&&e(n).trigger(g.TRIGGER,[g.ERROR,d]);return c},date:function(){return this.d.apply(this,sliceArgs(arguments))},daterange:function(n){var p=this,a=p.d(n),m,o,d,b,c;if(a){if(n.is("[fromDateEl]")){d=p.getElement(n.attr("fromDateEl"),n);b=n}if(n.is("[toDateEl]")){d=n;b=p.getElement(n.attr("toDateEl"),n)}if(!(d&&d.length&&b&&b.length)){c=p.sametypeitems(n);if(c.length>=2){d=e(c[0]);b=e(c[1])}}if(d&&d.length||b&&b.length){JC.log("daterange",d.length,b.length);b.val(e.trim(b.val()));d.val(e.trim(d.val()));if(b[0]!=d[0]&&b.val().length&&d.val().length){a&&(a=p.d(b,true))&&(m=parseISODate(d.val()));a&&(a=p.d(d,true))&&(o=parseISODate(b.val()));a&&m&&o&&m.getTime()>o.getTime()&&(a=false);a&&e(p).trigger(g.TRIGGER,[g.CORRECT,d]);a&&e(p).trigger(g.TRIGGER,[g.CORRECT,b]);!a&&e(p).trigger(g.TRIGGER,[g.ERROR,d]);!a&&e(p).trigger(g.TRIGGER,[g.ERROR,b])}}}return a},time:function(b){var c=this,a=/^(([0-1]\d)|(2[0-3])):[0-5]\d:[0-5]\d$/.test(b.val());!a&&e(c).trigger(g.TRIGGER,[g.ERROR,b]);return a},minute:function(b){var c=this,a=/^(([0-1]\d)|(2[0-3])):[0-5]\d$/.test(b.val());!a&&e(c).trigger(g.TRIGGER,[g.ERROR,b]);return a},bankcard:function(b){var c=this,a=/^[1-9][\d]{3}(?: |)(?:[\d]{4}(?: |))(?:[\d]{4}(?: |))(?:[\d]{4})(?:(?: |)[\d]{3}|)$/.test(b.val());!a&&e(c).trigger(g.TRIGGER,[g.ERROR,b]);return a},cnname:function(b){var c=this,a=c.bytelen(b.val())<32&&/^[\u4e00-\u9fa5a-zA-Z.\u3002\u2022]{2,32}$/.test(b.val());!a&&e(c).trigger(g.TRIGGER,[g.ERROR,b]);return a},username:function(b){var c=this,a=/^[a-zA-Z0-9][\w-]{2,30}$/.test(b.val());!a&&e(c).trigger(g.TRIGGER,[g.ERROR,b]);return a},idnumber:function(b){var c=this,a=/^[0-9]{15}(?:[0-9]{2}(?:[0-9xX])|)$/.test(b.val());!a&&e(c).trigger(g.TRIGGER,[g.ERROR,b]);return a},mobilecode:function(b,c){var d=this,a=/^(?:13|14|15|16|18|19)[\d]{9}$/.test(b.val());!c&&!a&&e(d).trigger(g.TRIGGER,[g.ERROR,b]);return a},mobile:function(a,b){return this.mobilecode(a,b)},mobilezonecode:function(b,c){var d=this,a=/^(?:\+[0-9]{1,6} |)(?:0|)(?:13|14|15|16|18|19)\d{9}$/.test(b.val());!c&&!a&&e(d).trigger(g.TRIGGER,[g.ERROR,b]);return a},phonecode:function(b){var c=this,a=/^[1-9][0-9]{6,7}$/.test(b.val());!a&&e(c).trigger(g.TRIGGER,[g.ERROR,b]);return a},phone:function(b,c){var d=this,a=/^(?:0(?:10|2\d|[3-9]\d\d)(?: |\-|)|)[1-9][\d]{6,7}$/.test(b.val());!c&&!a&&e(d).trigger(g.TRIGGER,[g.ERROR,b]);return a},phoneall:function(b,c){var d=this,a=/^(?:\+[\d]{1,6}(?: |\-)|)(?:0[\d]{2,3}(?:\-| |)|)[1-9][\d]{6,7}(?:(?: |)(?:\#|\-)[\d]{1,6}|)$/.test(b.val());!c&&!a&&e(d).trigger(g.TRIGGER,[g.ERROR,b]);return a},phonezone:function(d){var l=this,c=d.val().trim(),b,a=/^[0-9]{3,4}$/,k;k=d.attr("datatype").split("-");k.length>1&&(a=new RegExp("^[0-9]{"+k[1]+"}$"));b=a.test(c);!b&&e(l).trigger(g.TRIGGER,[g.ERROR,d]);return b},phoneext:function(b){var c=this,a=/^[0-9]{1,6}$/.test(b.val());!a&&e(c).trigger(g.TRIGGER,[g.ERROR,b]);return a},mobilephone:function(b){var c=this,a=this.mobilecode(b,true)||this.phone(b,true);!a&&e(c).trigger(g.TRIGGER,[g.ERROR,b]);return a},mobilephoneall:function(b){var c=this,a=this.mobilezonecode(b,true)||this.phoneall(b,true);!a&&e(c).trigger(g.TRIGGER,[g.ERROR,b]);return a},reg:function(b){var d=this,a=true,c;if(b.is("[reg-pattern]")){c=b.attr("reg-pattern")}if(!c){c=e.trim(b.attr("datatype")).replace(/^reg(?:\-|)/i,"")}c.replace(/^\/([\s\S]*)\/([\w]{0,3})$/,function(m,n,l){JC.log(n,l);a=new RegExp(n,l||"").test(b.val())});!a&&e(d).trigger(g.TRIGGER,[g.ERROR,b]);return a},vcode:function(b){var d=this,a,c=parseInt(e.trim(b.attr("datatype")).replace(/^vcode(?:\-|)/i,""),10)||4;JC.log("vcodeValid: "+c);a=new RegExp("^[0-9a-zA-Z]{"+c+"}$").test(b.val());!a&&e(d).trigger(g.TRIGGER,[g.ERROR,b]);return a},text:function(a){return true},bytetext:function(a){return true},richtext:function(a){return true},bytelen:function(a){return a.replace(/[^\x00-\xff]/g,"11").length},url:function(b){var c=this,a=/^((http|ftp|https):\/\/|)[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])$/.test(b.val());!a&&e(c).trigger(g.TRIGGER,[g.ERROR,b]);return a},domain:function(b){var c=this,a=/^(?:htt(?:p|ps)\:\/\/|)((?:(?:(?:\w[\.\-\+]*))\w)*)((?:(?:(?:\w[\.\-\+]*){0,62})\w)+)\.(\w{2,6})(?:\/|)$/.test(b.val());!a&&e(c).trigger(g.TRIGGER,[g.ERROR,b]);return a},stricdomain:function(b){var c=this,a=/^((?:(?:(?:\w[\.\-\+]*))\w)*)((?:(?:(?:\w[\.\-\+]*){0,62})\w)+)\.(\w{2,6})$/.test(b.val());!a&&e(c).trigger(g.TRIGGER,[g.ERROR,b]);return a},email:function(b){var c=this,a=/^[A-Z0-9._%-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i.test(b.val());!a&&e(c).trigger(g.TRIGGER,[g.ERROR,b]);return a},countrycode:function(c){var d=this,b=c.val().trim(),a=/^(?:\+|)[\d]{1,6}$/.test(b);!a&&e(d).trigger(g.TRIGGER,[g.ERROR,c]);return a},zipcode:function(b){var c=this,a=/^[0-9]{6}$/.test(b.val());!a&&e(c).trigger(g.TRIGGER,[g.ERROR,b]);return a},taxcode:function(c){var d=this,a=false,b=c.val().trim();a=/^[\w]{15}$/.test(b)||/^[\w]{18}$/.test(b)||/^[\w]{20}$/.test(b);!a&&e(d).trigger(g.TRIGGER,[g.ERROR,c]);return a},reconfirm:function(b){var n=this,a=true,m,d="ReconfirmValidTime",c="reconfirm";JC.log(c,new Date().getTime());n.isDatatarget(b,c)&&(m=n.datatarget(b,c));!(m&&m.length)&&(m=n.samesubtypeitems(b,c));var l=false;if(m&&m.length){m.each(function(){var i=e(this);if(n.checkRepeatProcess(i,d,true)){l=true}if(b.val()!=e(this).val()){a=false}})}!a&&m.length&&m.each(function(){if(b[0]==this){return}e(n).trigger(g.TRIGGER,[g.ERROR,e(this),"reconfirmmsg",true])});if(a&&m&&m.length){m.each(function(){if(b[0]==this){return}if(l){return false}e(n).trigger(g.TRIGGER,[g.CORRECT,e(this)])})}a?e(n).trigger(g.TRIGGER,[g.CORRECT,b]):e(n).trigger(g.TRIGGER,[g.ERROR,b,"reconfirmmsg",true]);return a},checkRepeatProcess:function(k,d,l,b){var c=new Date().getTime(),a=false;b=b||200;if(k.data(d)){if((c-k.data(d))<b){a=true;k.data(d,c)}}l&&k.data(d,c);return a},alternative:function(d){var q=this,a=true,r,n="AlternativeValidTime",b=q.parseDatatype(d),c="alternative";JC.log(c,new Date().getTime());q.isDatatarget(d,c)&&(r=q.datatarget(d,c));!(r&&r.length)&&(r=q.samesubtypeitems(d,c));var o=false;if(r.length&&!e.trim(d.val())){var p=false;r.each(function(){var i=e(this);if(d[0]==this){return}if(q.checkRepeatProcess(i,n,true)){o=true}if(e(this).val()){p=true;return false}});a=p}!a&&r&&r.length&&r.each(function(){if(d[0]==this){return}if(o){return false}e(q).trigger(g.TRIGGER,[g.ERROR,e(this),"alternativemsg",true])});if(a&&r&&r.length){r.each(function(){if(d[0]==this){return}var j=e(this),i=q.parseDatatype(j);if(i&&q[i]&&e(this).val()){q[i](e(this))}else{if(!e(this).val()){e(q).trigger(g.TRIGGER,[g.CORRECT,e(this)])}}})}if(a){if(b&&q[b]&&d.val()){q[b](d)}else{if(!d.val()){e(q).trigger(g.TRIGGER,[g.CORRECT,d])}}}else{e(q).trigger(g.TRIGGER,[g.ERROR,d,"alternativemsg",true])}return a},unique:function(d){var t=this,a=true,u,q,v=[],b=t.typeLen(d.attr("subdatatype"))[0],p="UniqueValidTime",c="unique";JC.log(c,new Date().getTime());t.isDatatarget(d,c)&&(u=t.datatarget(d,c));!(u&&u.length)&&(u=t.samesubtypeitems(d,c));_errLs=[];_corLs=[];var r=false;if(u&&u.length){q={};u.each(function(i){var j=e(this);if(t.checkRepeatProcess(j,p,true)){r=true}if(i%b===0){v.push([])}v[v.length-1]&&v[v.length-1].push(j)});e.each(v,function(l,i){var j=[];e.each(i,function(o,n){j.push(e(n).val().trim())});var m=j.join(""),k=j.join("IOU~IOU");if(!m){return}if(k in q){q[k].push(i);a=false}else{q[k]=[i]}});for(var s in q){if(q[s].length>1){a=false;e.each(q[s],function(j,i){_errLs=_errLs.concat(i)})}else{e.each(q[s],function(j,i){_corLs=_corLs.concat(i)})}}}e.each(_corLs,function(j,i){f.setValid(i)});!a&&_errLs.length&&e.each(_errLs,function(j,i){i=e(i);if(r){return false}i.val()&&e(t).trigger(g.TRIGGER,[g.ERROR,i,"uniquemsg",true])});return a},typeLen:function(a){var b=[1];a&&(a=a.replace(/[^\d\.]/g,""))&&(b=a.split("."))&&(b[0]=parseInt(b[0],10)||1,b[1]=parseInt(b[1],10)||0);return b},findValidEle:function(c){var j=this,d="~ em.validmsg",a=c.find(d),b;if(c.attr("validel")&&(b=j.getElement(c.attr("validel"),c,d)).length){a=b}return a},findFocusEle:function(c){var j=this,d="~ em.focusmsg",a=c.find(d),b;if(c.attr("focusel")&&(b=j.getElement(c.attr("focusel"),c,d)).length){a=b}return a},findErrorEle:function(b){var d=this,c=g.SELECTOR_ERROR,a=b.find(c);if(b.attr("emel")&&(_tmp=d.getElement(b.attr("emel"),b,c)).length){a=_tmp}return a},getElement:function(c,b,a){if(/^\^$/.test(c)){a=a||g.SELECTOR_ERROR;c=e(b.parent().find(a))}else{if(/^[\/\|\<]/.test(c)){c=parentSelector(b,c)}else{if(/\./.test(c)){return e(c)}else{if(/^[\w-]+$/.test(c)){c="#"+c;c=e(c.replace(/[\#]+/g,"#"))}}}}return e(c)},errorMsg:function(b,c,d){var a=b.is("[errmsg]")?" "+b.attr("errmsg"):b.is("[reqmsg]")?b.attr("reqmsg"):"";c&&(a=b.attr(c)||a);d&&a&&(a=" "+a);a=(a||"").trim().toLowerCase()=="undefined"||typeof a==undefined?"":a;if(a&&!/^[\s]/.test(a)){switch(b.prop("type").toLowerCase()){case"file":a="请上传"+a;break;case"select-multiple":case"select-one":case"checkbox":case"radio":case"select":a="请选择"+a;break;case"textarea":case"password":case"text":a="请填写"+a;break}}return e.trim(a)},reqmsg:function(b){var a=true,c=this;if(!c.isReqmsg(b)){return a}if(b.val()&&b.val().constructor==Array){a=!!(e.trim(b.val().join("")+""))}else{a=!!e.trim(b.val()||"")}!a&&e(c).trigger(g.TRIGGER,[g.ERROR,b,"reqmsg"]);JC.log("regmsgValid: "+a);return a},sametypeitems:function(d){var l=this,b=[],c=d.parent(),k=d.attr("datatype"),a=new RegExp(k,"i");if(/select/i.test(d.prop("nodeName"))){c.find("[datatype]").each(function(){a.test(e(this).attr("datatype"))&&b.push(e(this))})}else{c.find("input[datatype]").each(function(){a.test(e(this).attr("datatype"))&&b.push(e(this))})}return b.length?e(b):b},samesubtypeitems:function(d,m){var o=this,b=[],c=d.parent(),m=m||d.attr("subdatatype"),a=new RegExp(m,"i"),p=d.prop("nodeName").toLowerCase(),n="input";if(/select/.test(p)){n="select"}else{if(/textarea/.test(p)){n="textarea"}}c.find(n+"[subdatatype]").each(function(){a.test(e(this).attr("subdatatype"))&&b.push(e(this))});return b.length?e(b):b},focusmsgeverytime:function(b){var a=f.focusmsgEverytime;b.is("[focusmsgeverytime]")&&(a=parseBool(b.attr("focusmsgeverytime")));return a},validemdisplaytype:function(c){c&&(c=e(c));var a=f.emDisplayType,d=getJqParent(c,"form"),b;d&&d.length&&d.is("[validemdisplaytype]")&&(b=d.attr("validemdisplaytype"))&&(a=b);c.is("[validemdisplaytype]")&&(b=c.attr("validemdisplaytype"))&&(a=b);return a},checkedType:function(d,r){d&&(d=e(d));r=r||"checkbox";var u=this,a=true,b,p,t=1,c=0,q=d,s=d.parent().prop("nodeName").toLowerCase()=="label",v=r+"finder";JC.log(d.attr("name")+", "+d.val());if(d.is("[datatarget]")){b=parentSelector(d,d.attr("datatarget"));p=[];b.each(function(){var i=e(this);i.is(":visible")&&!i.prop("disabled")&&p.push(i)});b=e(p)}else{if(s){if(!q.is("["+v+"]")){q=d.parent().parent()}else{q=parentSelector(d,d.attr(v))}p=parentSelector(q,"|input[datatype]")}else{p=parentSelector(q,"/input[datatype]")}b=[];p.each(function(){var j=e(this);var i=new RegExp(r,"i");i.test(j.attr("datatype"))&&j.is(":visible")&&!j.prop("disabled")&&b.push(j)});b=e(b)}if(s){b.each(function(){var i=e(this);if(!i.is("[emel]")){i.attr("emel","//em.error")}if(!i.is("[validel]")){i.attr("validel","//em.validmsg")}if(!i.is("[focusel]")){i.attr("focusel","//em.focusmsg")}})}b.length&&e(d=b[b.length-1]).data("Last"+r,true);if(b.length){d.is("[datatype]")&&d.attr("datatype").replace(/[^\-]+?\-([\d]+)/,function(i,j){t=parseInt(j,10)||t});if(b.length>=t){b.each(function(){e(this).prop("checked")&&c++});if(c<t){a=false}}!a&&e(u).trigger(g.TRIGGER,[g.ERROR,d])}return a},checkbox:function(a){return this.checkedType(a,"checkbox")},radio:function(a){return this.checkedType(a,"radio")},file:function(l){var m=this,b=true,c=l.val().trim().toLowerCase(),n=m.dataFileExt(l),a,d;if(n.length){b=false;e.each(n,function(i,j){j+="$";a=new RegExp(j,"i");if(a.test(c)){b=true;return false}})}!b&&e(m).trigger(g.TRIGGER,[g.ERROR,l]);return b},dataFileExt:function(c){var a=[],b;c.is("[fileext]")&&(b=c.attr("fileext").replace(/[\s]+/g,""))&&(b=b.replace(/\./g,"\\."))&&(a=b.toLowerCase().split(","));return a}};function h(a){this._model=a}h.prototype={init:function(){return this},valid:function(c,a,d){c&&(c=e(c));var j=this,b;setTimeout(function(){c.removeClass(g.CSS_ERROR);c.find(printf('~ em:not("em.focusmsg, em.validmsg, {0}")',g.FILTER_ERROR)).css("display",j._model.validemdisplaytype(c));c.find(g.SELECTOR_ERROR).hide();c.attr("emel")&&(b=j._model.getElement(c.attr("emel"),c))&&b.hide();typeof d=="undefined"&&typeof c.val()!="object"&&!c.val().trim()&&(d=1);j.validMsg(c,d);(b=j._model.validitemcallback(c))&&b(c,true)},a||150)},validMsg:function(l,m){var n=this,a=(l.attr("validmsg")||"").trim().toLowerCase();if(n._model.isValidMsg(l)){if(a=="true"||a=="1"){a=""}!a.trim()&&(a="&nbsp;");var b=n._model.findFocusEle(l),c=n._model.findValidEle(l),d=n._model.findErrorEle(l);!c.length&&(c=e('<em class="validmsg"></em>'),l.after(c));c.html(a);m?c.hide():(c.css("display",n._model.validemdisplaytype(l)),b&&b.hide(),d&&d.hide())}},error:function(a,b,c){a&&(a=e(a));var d=this,j=arguments;if(a.is("[validnoerror]")){return true}setTimeout(function(){var i=d._model.errorMsg.apply(d._model,sliceArgs(j)),p,n,o;a.addClass(g.CSS_ERROR);a.find(printf("~ em:not({0})",g.FILTER_ERROR)).hide();if(a.is("[validel]")){(n=d._model.getElement(a.attr("validel"),a))&&n.hide()}if(a.is("[focusel]")){(o=d._model.getElement(a.attr("focusel"),a))&&o.hide()}if(a.is("[emEl]")){(p=d._model.getElement(a.attr("emEl"),a))&&p.addClass(g.CSS_ERROR)}!(p&&p.length)&&(p=a.find(g.SELECTOR_ERROR));if(!p.length){(p=e(printf('<em class="{0}"></em>',g.CSS_ERROR))).insertAfter(a)}!i.trim()&&(i="&nbsp;");p.html(i).css("display",d._model.validemdisplaytype(a));JC.log("error:",i)},150);(_tmp=d._model.validitemcallback(a))&&_tmp(a,false);return false},focusmsg:function(o,m){if(o&&(o=e(o)).length&&o.is("[focusmsg]")){JC.log("focusmsg",new Date().getTime());var c,p=this,a=p._model.findFocusEle(o),d=p._model.findValidEle(o),n=p._model.findErrorEle(o),b=o.attr("focusmsg");if(m&&a&&a.length){a.hide();return}n.length&&n.is(":visible")&&n.hide();if(d.length&&d.is(":visible")){return}!a.length&&(a=e('<em class="focusmsg"></em>'),o.after(a));if(o.is("[validnoerror]")){c=f.getInstance().parse(o)}else{o.attr("validnoerror",true);c=f.getInstance().parse(o);o.removeAttr("validnoerror")}!b.trim()&&(b="&nbsp;");if(p._model.focusmsgeverytime(o)){a.html(b).css("display",p._model.validemdisplaytype(o))}else{c&&a.html(b).css("display",p._model.validemdisplaytype(o))}}}};e(document).delegate("input[type=text], input[type=password], textarea","blur",function(a){f.getInstance().trigger("FocusMsg",[e(this),true]);f.check(e(this))});e(document).delegate("select, input[type=file], input[type=checkbox], input[type=radio]","change",function(a){f.check(e(this))});e(document).delegate("input[type=text], input[type=password], textarea, select, input[type=file], input[type=checkbox], input[type=radio]","focus",function(a){f.getInstance().trigger("FocusMsg",[e(this)])});e(document).delegate("select, input[type=file], input[type=checkbox], input[type=radio]","blur",function(a){f.getInstance().trigger("FocusMsg",[e(this),true])})}(jQuery));