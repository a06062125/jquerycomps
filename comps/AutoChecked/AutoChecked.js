(function(b){JC.Form&&(JC.Form.initCheckAll=a);JC.AutoChecked=a;function a(e){e=b(e);if(!(e&&e.length)){return}if(e.prop("nodeName").toLowerCase()!="input"){return a.init(e)}if(a.getInstance(e)){return a.getInstance(e)}a.getInstance(e,this);JC.log("AutoChecked init",new Date().getTime());this._model=new d(e);this._view=new c(this._model);this._init()}a.init=function(f){f=b(f);if(!(f&&f.length)){return}var g=f.find("input[type=checkbox][checktype][checkfor]"),e;g.each(function(){e=b(this);if(!a.isAutoChecked(e)){return}if(a.getInstance(e)){a.getInstance(e).update();return}new a(e)})};a.prototype={_init:function(){var e=this;e._initHandlerEvent();b([e._view,e._model]).on("BindEvent",function(f,h,g){e.on(h,g)});b([e._view,e._model]).on("TriggerEvent",function(f,h){var g=sliceArgs(arguments);g.shift();g.shift();e.trigger(h,g)});e._model.init();e._view.init();e._view.itemChange();return e},_initHandlerEvent:function(){var e=this;e.selector().on("change",function(){e.trigger(e._model.checktype())});e.on("all",function(){JC.log("AutoChecked all",new Date().getTime());e._view.allChange()});e.on("inverse",function(){JC.log("AutoChecked inverse",new Date().getTime());e._view.inverseChange()});if(!(e._model.checktype()=="inverse"&&e._model.hasCheckAll())){b(e._model.delegateElement()).delegate(e._model.delegateSelector(),"click",function(f){if(a.isAutoChecked(b(this))){return}JC.log("AutoChecked change",new Date().getTime());e._view.itemChange()})}},update:function(){this._view.itemChange();return this},selector:function(){return this._model.selector()},on:function(f,e){b(this).on(f,e);return this},trigger:function(f,e){b(this).trigger(f,e);return this}};a.getInstance=function(e,f){if(typeof e=="string"&&!/</.test(e)){e=b(e)}if(!(e&&e.length)||(typeof e=="string")){return}typeof f!="undefined"&&e.data("AutoCheckedIns",f);return e.data("AutoCheckedIns")};a.isAutoChecked=function(e){var f;e&&(e=b(e)).length&&(f=e.is("[checkfor]")&&e.is("[checktype]"));return f};function d(e){this._selector=e}d.isParentSelectorRe=/^[\/\|<]/;d.parentSelectorRe=/[^\/\|<]/g;d.childSelectorRe=/[\/\|<]/g;d.prototype={init:function(){return this},checktype:function(){return(this.selector().attr("checktype")||"").toLowerCase()},checkfor:function(){return(this.selector().attr("checkfor")||"")},checkall:function(){return(this.selector().attr("checkall")||"")},hasCheckAll:function(){return this.selector().is("[checkall]")&&this.selector().attr("checkall")},selector:function(){return this._selector},isParentSelector:function(){return d.isParentSelectorRe.test(this.selector().attr("checkfor"))},delegateSelector:function(){var f=this.selector().attr("checkfor"),e;if(this.isParentSelector()){if(/^</.test(this.checkfor())){this.checkfor().replace(/[\s]([\s\S]+)/,function(h,g){f=g})}else{f=this.checkfor().replace(d.childSelectorRe,"")}}return f},delegateElement:function(){var e=this,g=b(document),f;if(this.isParentSelector()){if(/^</.test(this.checkfor())){this.checkfor().replace(/^([^\s]+)/,function(i,h){g=parentSelector(e.selector(),h)})}else{f=this.checkfor().replace(d.parentSelectorRe,"");g=parentSelector(e.selector(),f)}}return g},items:function(){return this.delegateElement().find(this.delegateSelector())},checkedAll:function(){return this.selector().prop("checked")},checkedInverse:function(){return this.selector().prop("checked")},allSelector:function(){var e;if(this.checktype()=="inverse"){this.checkall()&&(e=parentSelector(this.selector(),this.checkall()))}else{e=this.selector()}return e}};function c(e){this._model=e}c.prototype={init:function(){return this},itemChange:function(){switch(this._model.checktype()){case"all":this._fixAll();break}},allChange:function(){var e=this,f=e._model.checkedAll();e._model.items().each(function(){if(a.isAutoChecked(b(this))){return}if(b(this).is("[disabled]")){return}b(this).prop("checked",f)})},inverseChange:function(){var e=this;e._model.items().each(function(){var f=b(this);if(a.isAutoChecked(f)){return}if(b(this).is("[disabled]")){return}f.prop("checked",!f.prop("checked"))});this._fixAll()},_fixAll:function(){var e=this,g=true,f=0;if(e._model.allSelector().prop("disabled")){return}e._model.items().each(function(){if(a.isAutoChecked(b(this))){return}if(b(this).is("[disabled]")){return}f++;if(!b(this).prop("checked")){return g=false}});JC.log("_fixAll:",g);if(!f){g=false}e._model.allSelector().prop("checked",g)}};b(document).ready(function(e){a.init(b(document))})}(jQuery));