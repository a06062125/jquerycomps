(function(e){JC.Form&&(JC.Form.initCheckAll=f);JC.AutoChecked=f;function f(a){a=e(a);if(!(a&&a.length)){return}if(a.prop("nodeName").toLowerCase()!="input"){return f.init(a)}if(f.getInstance(a)){return f.getInstance(a)}f.getInstance(a,this);JC.log("AutoChecked init",new Date().getTime());this._model=new g(a);this._view=new h(this._model);this._init()}f.init=function(b){b=e(b);if(!(b&&b.length)){return}var a=b.find("input[type=checkbox][checktype][checkfor]"),c;a.each(function(){c=e(this);if(!f.isAutoChecked(c)){return}if(f.getInstance(c)){f.getInstance(c).update();return}new f(c)})};f.prototype={_init:function(){var a=this;a._initHandlerEvent();e([a._view,a._model]).on("BindEvent",function(d,b,c){a.on(b,c)});e([a._view,a._model]).on("TriggerEvent",function(d,b){var c=sliceArgs(arguments);c.shift();c.shift();a.trigger(b,c)});a._model.init();a._view.init();a._view.itemChange();return a},_initHandlerEvent:function(){var a=this;a.selector().on("change",function(){a.trigger(a._model.checktype())});a.on("all",function(){JC.log("AutoChecked all",new Date().getTime());a._view.allChange()});a.on("inverse",function(){JC.log("AutoChecked inverse",new Date().getTime());a._view.inverseChange()});if(!(a._model.checktype()=="inverse"&&a._model.hasCheckAll())){e(a._model.delegateElement()).delegate(a._model.delegateSelector(),"click",function(b){if(f.isAutoChecked(e(this))){return}JC.log("AutoChecked change",new Date().getTime());a._view.itemChange()})}},update:function(){this._view.itemChange();return this},selector:function(){return this._model.selector()},on:function(a,b){e(this).on(a,b);return this},trigger:function(a,b){e(this).trigger(a,b);return this}};f.getInstance=function(b,a){if(typeof b=="string"&&!/</.test(b)){b=e(b)}if(!(b&&b.length)||(typeof b=="string")){return}typeof a!="undefined"&&b.data("AutoCheckedIns",a);return b.data("AutoCheckedIns")};f.isAutoChecked=function(b){var a;b&&(b=e(b)).length&&(a=b.is("[checkfor]")&&b.is("[checktype]"));return a};function g(a){this._selector=a}g.isParentSelectorRe=/^[\/\|<]/;g.parentSelectorRe=/[^\/\|<]/g;g.childSelectorRe=/[\/\|<]/g;g.prototype={init:function(){return this},checktype:function(){return(this.selector().attr("checktype")||"").toLowerCase()},checkfor:function(){return(this.selector().attr("checkfor")||"")},checkall:function(){return(this.selector().attr("checkall")||"")},checktrigger:function(){return(this.selector().attr("checktrigger")||"")},hasCheckAll:function(){return this.selector().is("[checkall]")&&this.selector().attr("checkall")},selector:function(){return this._selector},isParentSelector:function(){return g.isParentSelectorRe.test(this.selector().attr("checkfor"))},delegateSelector:function(){var a=this.selector().attr("checkfor"),b;if(this.isParentSelector()){if(/^</.test(this.checkfor())){this.checkfor().replace(/[\s]([\s\S]+)/,function(c,d){a=d})}else{a=this.checkfor().replace(g.childSelectorRe,"")}}return a},delegateElement:function(){var c=this,a=e(document),b;if(this.isParentSelector()){if(/^</.test(this.checkfor())){this.checkfor().replace(/^([^\s]+)/,function(d,j){a=parentSelector(c.selector(),j)})}else{b=this.checkfor().replace(g.parentSelectorRe,"");a=parentSelector(c.selector(),b)}}return a},items:function(){return this.delegateElement().find(this.delegateSelector())},checkedAll:function(){return this.selector().prop("checked")},checkedInverse:function(){return this.selector().prop("checked")},allSelector:function(){var a;if(this.checktype()=="inverse"){this.checkall()&&(a=parentSelector(this.selector(),this.checkall()))}else{a=this.selector()}return a}};function h(a){this._model=a}h.prototype={init:function(){return this},itemChange:function(){switch(this._model.checktype()){case"all":this._fixAll();break}},allChange:function(){var b=this,a=b._model.checkedAll();b._model.items().each(function(){var c=e(this);if(f.isAutoChecked(c)){return}if(c.is("[disabled]")){return}c.prop("checked",a);b.triggerEvent(c)})},inverseChange:function(){var a=this;a._model.items().each(function(){var b=e(this);if(f.isAutoChecked(b)){return}if(b.is("[disabled]")){return}b.prop("checked",!b.prop("checked"));a.triggerEvent(b)});this._fixAll()},_fixAll:function(){var c=this,a=true,b=0;if(c._model.allSelector().prop("disabled")){return}c._model.items().each(function(){if(f.isAutoChecked(e(this))){return}if(e(this).is("[disabled]")){return}b++;if(!e(this).prop("checked")){return a=false}});JC.log("_fixAll:",a);if(!b){a=false}c._model.allSelector().prop("checked",a)},triggerEvent:function(b){var c=this,a=c._model.checktrigger();a&&e(b).trigger(a)}};e(document).ready(function(a){f.init(e(document))})}(jQuery));