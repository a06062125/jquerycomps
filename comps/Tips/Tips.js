(function(l){window.Tips=JC.Tips=k;function k(a){a=l(a);if(!(a&&a.length)){return this}if(a.length>1){return k.init(a)}if(k.getInstance(a)){return k.getInstance(a)}k.getInstance(a,this);this._model=new i(a);this._view=new j(this._model);this._init()}k.prototype={_init:function(){var a=this;l(this._view).on("BindEvent",function(d,b,c){a.on(b,c)});l(this._view).on("TriggerEvent",function(d,b,c){a.trigger(b,c)});this._view.init();this._model.selector().on("mouseenter",h);return this},show:function(a){this._view.show(a);return this},hide:function(){this._view.hide();return this},selector:function(){return this._model.selector()},layout:function(a){return this._view.layout(a)},data:function(){return this._model.data()},on:function(a,b){l(this).on(a,b);return this},trigger:function(a,b){l(this).trigger(a,b);return this}};k.init=function(b){if(!b){return}b=l(b);if(!b.length){return}var a=[];b.each(function(){var c=l(this);if(k.getInstance(c)){return}a.push(new k(c))});return a};k.hide=function(){l("body > div.UTips").hide()};k.autoInit=true;k.tpl=null;k.offset={bottom:{x:15,y:15},left:{x:-28,y:5},top:{x:-2,y:-22}};k.minWidth=200;k.maxWidth=400;k.titleToTipsdata=function(a){a=l(a);if(!JC.Tips.autoInit||(typeof window.event=="object"&&document.attachEvent)){a.each(function(){l(this).attr("tipsData",l(this).attr("title")).removeAttr("title")})}};k.getInstance=function(b,a){a&&b&&l(b).data("TipsIns",a);return b?l(b).data("TipsIns"):null};function i(a){this.tpl=g;this._selector=a;this._data;this._init()}i.prototype={_init:function(){this.update();return this},data:function(a){a&&this.update();return this._data},update:function(){if(!(this._selector.attr("title")||this._selector.attr("tipsData"))){return}this._data=l.trim(this._selector.attr("title")||this._selector.attr("tipsData")).replace(/(?:\r\n|\n\r|\r|\n)/g,"<br />");this._selector.removeAttr("title").removeAttr("tipsData");if(this.isInited()){return}this.isInited(true)},isInited:function(a){typeof a!="undefined"&&(this._selector.data("initedTips",a));return this._selector.data("initedTips")},selector:function(){return this._selector},tipsinitedcallback:function(){var a;this._selector.attr("tipsinitedcallback")&&(a=window[this._selector.attr("tipsinitedcallback")]);return a},tipsshowcallback:function(){var a;this._selector.attr("tipsshowcallback")&&(a=window[this._selector.attr("tipsshowcallback")]);return a},tipshidecallback:function(){var a;this._selector.attr("tipshidecallback")&&(a=window[this._selector.attr("tipshidecallback")]);return a},tipstemplatebox:function(){var a;this._selector.is("[tipstemplatebox]")&&(a=l(this._selector.attr("tipstemplatebox")).html().trim().replace(/[\r\n]+/g,""));this._selector.is("[tipstemplatesbox]")&&(a=l(this._selector.attr("tipstemplatesbox")).html().trim().replace(/[\r\n]+/g,""));return a},tipstemplatesbox:function(){return this.tipstemplatebox()},tipsupdateonce:function(){var a;this._selector.attr("tipsupdateonce")&&(a=parseBool(this._selector.attr("tipsupdateonce")));return a},tipsIsUpdated:function(a){typeof a!="undefined"&&this._selector.data("TipsUpdated",a);return this._selector.data("TipsUpdated")},layout:function(){if(!this._layout){if(this.tipstemplatesbox()){this._layout=l(this.tipstemplatesbox());this._layout.appendTo(document.body)}else{this._layout=l("#JCTipsLayout");if(!(this._layout&&this._layout.length)){this._layout=l(this.tipstemplatesbox()||JC.Tips.tpl||this.tpl);this._layout.attr("id","JCTipsLayout").css("position","absolute");this._layout.appendTo(document.body)}}}return this._layout}};function j(a){this._model=a;this._layout}j.prototype={init:function(){l(this).trigger("BindEvent",["TipsShow",this._model.tipsshowcallback()]);l(this).trigger("BindEvent",["TipsHide",this._model.tipshidecallback()]);l(this).trigger("BindEvent",["TipsInited",this._model.tipsinitedcallback()]);return this},show:function(y){var b=y.pageX,c=y.pageY;b+=JC.Tips.offset.bottom.x;c+=JC.Tips.offset.bottom.y;var e=l(document).scrollTop(),f=l(document).scrollLeft();var x=l(window).width(),v=l(window).height();var a=this.layout().width(),d=this.layout().height();var C=f+x-a,A=f;var D=e+v-d,B=e;var w=false,z=false;b>C&&(b=b-a+JC.Tips.offset.left.x,c+=JC.Tips.offset.left.y,w=true);b<A&&(b=A);c>D&&(c=c-d+JC.Tips.offset.top.y,b+=JC.Tips.offset.top.x,z=true);c<B&&(c=B);w&&z&&(c-=5);this.layout().css({left:b+"px",top:c+"px"});this.layout().show();l(this).trigger("TriggerEvent",["TipsShow",this._model.tipsshowcallback()])},hide:function(){this.layout().hide();l(this).trigger("TriggerEvent","TipsHide")},layout:function(a){this._layout=this._model.layout();a&&this.update();return this._layout},update:function(){if(this._model.tipsupdateonce()&&this._model.tipsIsUpdated()){return}var b=this._model.data(1);this._layout.html(b).css({width:"auto",left:"-9999px",top:"-9999px",display:"block"});var c=this._layout.width(),a=this._layout.height();c<JC.Tips.minWidth&&this._layout.css("width",JC.Tips.minWidth+"px");c>JC.Tips.maxWidth&&this._layout.css("width",JC.Tips.maxWidth+"px");this._model.tipsIsUpdated(true)}};function h(b){var c=l(this),d=k.getInstance(c);d.layout(1).css("z-index",ZINDEX_COUNT++);if(!d.data()){return}d.show(b);l(document).on("mousemove",e);c.on("mouseleave",a);function e(f){if(!d.layout().is(":visible")){l(document).unbind("mousemove",e);l(c).unbind("mouseleave",a);return}d.show(f)}function a(f){l(document).unbind("mousemove",e);l(c).unbind("mouseleave",a);d.hide()}}var g='<div class="UTips"></div>';l(document).ready(function(a){setTimeout(function(){if(!JC.Tips.autoInit){return}k.titleToTipsdata(l("[title]"));l(document).delegate("*","mouseover",function(b){var c=l(this);if(k.getInstance(c)){return}if(!(c.attr("title")||c.attr("tipsData"))){return}JC.Tips.init(c);h.call(this,b)})},10)})}(jQuery));