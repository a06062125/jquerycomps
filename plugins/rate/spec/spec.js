isClear=true;function context(b,a){describe(b,a)}function build(){$("body").append('<div id="element"></div>')}function buildDivTarget(){$("body").append('<div id="hint"></div>')}function buildComboboxTarget(){$("body").append('<select id="hint"><option value="Cancel this rating!">cancel hint default</option><option value="cancel-hint-custom">cancel hint custom</option><option value="">cancel number default</option><option value="0">cancel number custom</option><option value="bad">bad hint imutable</option><option value="1">bad number imutable</option><option value="targetText">targetText is setted without targetKeep</option><option value="score: bad">targetFormat</option></select>')}function buildTextareaTarget(){$("body").append('<textarea id="hint"></textarea>')}function buildTextTarget(){$("body").append('<input id="hint" type="text" />')}function clear(){if(isClear){$("#element").remove();$("#hint").remove()}}describe("Raty",function(){beforeEach(function(){build()});afterEach(function(){clear()});it("has the right values",function(){var b=$.fn.raty;var a=b.defaults;expect(a.cancel).toBeFalsy();expect(a.cancelHint).toEqual("Cancel this rating!");expect(a.cancelOff).toEqual("cancel-off.png");expect(a.cancelOn).toEqual("cancel-on.png");expect(a.cancelPlace).toEqual("left");expect(a.click).toBeUndefined();expect(a.half).toBeFalsy();expect(a.halfShow).toBeTruthy();expect(a.hints).toContain("bad","poor","regular","good","gorgeous");expect(a.iconRange).toBeUndefined();expect(a.mouseover).toBeUndefined();expect(a.noRatedMsg).toEqual("Not rated yet!");expect(a.number).toBe(5);expect(a.path).toEqual("");expect(a.precision).toBeFalsy();expect(a.readOnly).toBeFalsy();expect(a.round.down).toEqual(0.25);expect(a.round.full).toEqual(0.6);expect(a.round.up).toEqual(0.76);expect(a.score).toBeUndefined();expect(a.scoreName).toEqual("score");expect(a.single).toBeFalsy();expect(a.size).toBe(16);expect(a.space).toBeTruthy();expect(a.starHalf).toEqual("star-half.png");expect(a.starOff).toEqual("star-off.png");expect(a.starOn).toEqual("star-on.png");expect(a.target).toBeUndefined();expect(a.targetFormat).toEqual("{score}");expect(a.targetKeep).toBeFalsy();expect(a.targetText).toEqual("");expect(a.targetType).toEqual("hint");expect(a.width).toBeUndefined()});describe("common features",function(){it("is chainable",function(){var a=$("#element");var b=a.raty();expect(b).toBe(a)});it("creates the default markup",function(){var a=$("#element");a.raty();var c=a.children("img"),b=a.children("input");expect(c.eq(0)).toHaveAttr("title","bad");expect(c.eq(1)).toHaveAttr("title","poor");expect(c.eq(2)).toHaveAttr("title","regular");expect(c.eq(3)).toHaveAttr("title","good");expect(c.eq(4)).toHaveAttr("title","gorgeous");expect(c).toHaveAttr("src","star-off.png");expect(b).toHaveAttr("type","hidden");expect(b).toHaveAttr("name","score");expect(b.val()).toEqual("")})});describe("#star",function(){it("starts all off",function(){var a=$("#element");a.raty();expect(a.children("img")).toHaveAttr("src","star-off.png")});context("on :mouseover",function(){it("turns on the stars",function(){var a=$("#element").raty(),b=a.children("img");b.eq(4).mouseover();expect(b).toHaveAttr("src","star-on.png")});context("and :mouseout",function(){it("clears all stars",function(){var a=$("#element").raty(),b=a.children("img");b.eq(4).mouseover().mouseout();expect(b).toHaveAttr("src","star-off.png")})})});context("on rating",function(){it("changes the score",function(){var a=$("#element").raty(),b=a.children("img");b.eq(1).mouseover().click();expect(a.children("input")).toHaveValue(2)});context("on :mouseout",function(){it("keeps the stars on",function(){var a=$("#element").raty(),b=a.children("img");b.eq(4).mouseover().click().mouseout();expect(b).toHaveAttr("src","star-on.png")})})})});describe("options",function(){describe("#numberMax",function(){it("limits to 20 stars",function(){var a=$("#element").raty({number:50,score:50});var b=a.raty("score");expect(a.children("img").length).toEqual(20);expect(a.children("input")).toHaveValue(20)});context("with custom numberMax",function(){it("chages the limit",function(){var a=$("#element").raty({numberMax:10,number:50,score:50});var b=a.raty("score");expect(a.children("img").length).toEqual(10);expect(a.children("input")).toHaveValue(10)})})});describe("#starOff",function(){it("changes the icons",function(){var a=$("#element");a.raty({starOff:"icon.png"});expect(a.children("img")).toHaveAttr("src","icon.png")})});describe("#starOn",function(){it("changes the icons",function(){var a=$("#element").raty({starOn:"icon.png"}),b=a.children("img");b.eq(3).mouseover();expect(b.eq(0)).toHaveAttr("src","icon.png");expect(b.eq(1)).toHaveAttr("src","icon.png");expect(b.eq(2)).toHaveAttr("src","icon.png");expect(b.eq(3)).toHaveAttr("src","icon.png");expect(b.eq(4)).toHaveAttr("src","star-off.png")})});describe("#iconRange",function(){it("uses icon intervals",function(){var a=$("#element");a.raty({iconRange:[{range:2,on:"a.png",off:"a-off.png"},{range:3,on:"b.png",off:"b-off.png"},{range:4,on:"c.png",off:"c-off.png"},{range:5,on:"d.png",off:"d-off.png"}]});var b=a.children("img");expect(b.eq(0)).toHaveAttr("src","a-off.png");expect(b.eq(1)).toHaveAttr("src","a-off.png");expect(b.eq(2)).toHaveAttr("src","b-off.png");expect(b.eq(3)).toHaveAttr("src","c-off.png");expect(b.eq(4)).toHaveAttr("src","d-off.png")});context("when off icon is not especified",function(){it("uses the :starOff icon",function(){var a=$("#element");a.raty({iconRange:[{range:2,on:"on.png",off:"off.png"},{range:3,on:"on.png",off:"off.png"},{range:4,on:"on.png",off:"off.png"},{range:5,on:"on.png"}]});expect(a.children("img").eq(4)).toHaveAttr("src","star-off.png")})});context("on mouseover",function(){it("uses the on icon",function(){var a=$("#element").raty({iconRange:[{range:2,on:"a.png",off:"a-off.png"},{range:3,on:"b.png",off:"b-off.png"},{range:4,on:"c.png",off:"c-off.png"},{range:5,on:"d.png",off:"d-off.png"}]}),b=a.children("img");b.eq(4).mouseover();expect(b.eq(0)).toHaveAttr("src","a.png");expect(b.eq(1)).toHaveAttr("src","a.png");expect(b.eq(2)).toHaveAttr("src","b.png");expect(b.eq(3)).toHaveAttr("src","c.png");expect(b.eq(4)).toHaveAttr("src","d.png")});context("when on icon is not especified",function(){it("uses the :starOn icon",function(){var a=$("#element").raty({iconRange:[{range:2,off:"off.png",on:"on.png"},{range:3,off:"off.png",on:"on.png"},{range:4,off:"off.png",on:"on.png"},{range:5,off:"off.png"}]}),b=a.children("img");b.eq(4).mouseover();expect(b.eq(0)).toHaveAttr("src","on.png");expect(b.eq(1)).toHaveAttr("src","on.png");expect(b.eq(2)).toHaveAttr("src","on.png");expect(b.eq(3)).toHaveAttr("src","on.png");expect(b.eq(4)).toHaveAttr("src","star-on.png")})})});context("on mouseout",function(){it("changes to off icons",function(){var a=$("#element").raty({iconRange:[{range:2,on:"a.png",off:"a-off.png"},{range:3,on:"b.png",off:"b-off.png"},{range:4,on:"c.png",off:"c-off.png"},{range:5,on:"d.png",off:"d-off.png"}]}),b=a.children("img");b.eq(4).mouseover();a.mouseleave();expect(b.eq(0)).toHaveAttr("src","a-off.png");expect(b.eq(1)).toHaveAttr("src","a-off.png");expect(b.eq(2)).toHaveAttr("src","b-off.png");expect(b.eq(3)).toHaveAttr("src","c-off.png");expect(b.eq(4)).toHaveAttr("src","d-off.png")});it("keeps the score value",function(){var a=$("#element").raty({iconRange:[{range:2,on:"a.png",off:"a-off.png"},{range:3,on:"b.png",off:"b-off.png"},{range:4,on:"c.png",off:"c-off.png"},{range:5,on:"d.png",off:"d-off.png"}],score:1});a.children("img").eq(4).mouseover();a.mouseleave();expect(a.children("input")).toHaveValue(1)});context("when off icon is not especified",function(){it("uses the :starOff icon",function(){var b=$("#element").raty({iconRange:[{range:2,on:"on.png",off:"off.png"},{range:3,on:"on.png",off:"off.png"},{range:4,on:"on.png",off:"off.png"},{range:5,on:"on.png"}]}),a=b.children("img").eq(4);a.mouseover();b.mouseleave();expect(a).toHaveAttr("src","star-off.png")})})})});describe("#click",function(){it("has `this` as the self element",function(){var a=$("#element").raty({click:function(){$(this).data("self",this)}});a.children("img:first").mouseover().click();expect(a.data("self")).toBe(a)});it("is called on star click",function(){var a=$("#element").raty({click:function(){$(this).data("clicked",true)}});a.children("img:first").mouseover().click();expect(a.data("clicked")).toBeTruthy()});it("receives the score",function(){var a=$("#element").raty({click:function(b){$(this).data("score",b)}});a.children("img:first").mouseover().click();expect(a.data("score")).toEqual(1)});context("with :cancel",function(){it("executes cancel click callback",function(){var a=$("#element").raty({cancel:true,click:function(b){$(this).data("score",null)}});a.children(".raty-cancel").mouseover().click().mouseleave();expect(a.data("score")).toBeNull()})})});describe("#score",function(){it("starts with value",function(){var a=$("#element");a.raty({score:1});expect(a.children("input")).toHaveValue(1)});it("turns on 1 stars",function(){var a=$("#element");a.raty({score:1});var b=a.children("img");expect(b.eq(0)).toHaveAttr("src","star-on.png");expect(b.eq(1)).toHaveAttr("src","star-off.png");expect(b.eq(2)).toHaveAttr("src","star-off.png");expect(b.eq(3)).toHaveAttr("src","star-off.png");expect(b.eq(4)).toHaveAttr("src","star-off.png")});it("accepts callback",function(){var a=$("#element");a.raty({score:function(){return 1}});expect(a.raty("score")).toEqual(1)});context("with negative number",function(){it("gets none score",function(){var a=$("#element");a.raty({score:-1});expect(a.children("input").val()).toEqual("")})});context("with :readOnly",function(){it("becomes readOnly too",function(){var a=$("#element");a.raty({readOnly:true});expect(a.children("input")).toHaveAttr("readonly","readonly")})})});describe("#scoreName",function(){it("changes the score field name",function(){var a=$("#element");a.raty({scoreName:"entity.score"});expect(a.children("input")).toHaveAttr("name","entity.score")})});it("accepts callback",function(){var a=$("#element");a.raty({scoreName:function(){return"custom"}});expect(a.data("settings").scoreName).toEqual("custom")});describe("#readOnly",function(){it('Applies "Not rated yet!" on stars',function(){var a=$("#element");a.raty({readOnly:true});expect(a.children("img")).toHaveAttr("title","Not rated yet!")});it("removes the pointer cursor",function(){var a=$("#element");a.raty({readOnly:true});expect(a).not.toHaveCss({cursor:"pointer"});expect(a).not.toHaveCss({cursor:"default"})});it("accepts callback",function(){var a=$("#element");a.raty({readOnly:function(){return true}});expect(a.data("settings").readOnly).toEqual(true)});it("avoids trigger mouseover",function(){var a=$("#element").raty({readOnly:true}),b=a.children("img");b.eq(1).mouseover();expect(b).toHaveAttr("src","star-off.png")});it("avoids trigger click",function(){var a=$("#element").raty({readOnly:true}),b=a.children("img");b.eq(1).mouseover().click().mouseleave();expect(b).toHaveAttr("src","star-off.png");expect(a.children("input").val()).toEqual("")});it("avoids trigger mouseleave",function(){var a=$("#element").raty({readOnly:true,mouseout:function(){$(this).data("mouseleave",true)}}),b=a.children("img");b.eq(1).mouseover();a.mouseleave();expect(a.data("mouseleave")).toBeFalsy()});context("with :score",function(){context("as integer",function(){it("applies the score title on stars",function(){var a=$("#element");a.raty({readOnly:true,score:3});expect(a.children("img")).toHaveAttr("title","regular")})});context("as float",function(){it("applies the integer score title on stars",function(){var a=$("#element");a.raty({readOnly:true,score:3.1});expect(a.children("img")).toHaveAttr("title","regular")})})});context("with :cancel",function(){it("hides the button",function(){var a=$("#element");a.raty({cancel:true,readOnly:true,path:"../lib/img"});expect(a.children(".raty-cancel")).toBeHidden()})})});describe("#hints",function(){it("changes the hints",function(){var a=$("#element");a.raty({hints:["1","/","c","-","#"]});var b=a.children("img");expect(b.eq(0)).toHaveAttr("title",1);expect(b.eq(1)).toHaveAttr("title","/");expect(b.eq(2)).toHaveAttr("title","c");expect(b.eq(3)).toHaveAttr("title","-");expect(b.eq(4)).toHaveAttr("title","#")});it("receives the number of the star when is undefined",function(){var a=$("#element");a.raty({hints:[undefined,"a","b","c","d"]});var b=a.children("img");expect(b.eq(0)).toHaveAttr("title","bad");expect(b.eq(1)).toHaveAttr("title","a");expect(b.eq(2)).toHaveAttr("title","b");expect(b.eq(3)).toHaveAttr("title","c");expect(b.eq(4)).toHaveAttr("title","d")});it("receives empty when is empty string",function(){var a=$("#element");a.raty({hints:["","a","b","c","d"]});var b=a.children("img");expect(b.eq(0)).toHaveAttr("title","");expect(b.eq(1)).toHaveAttr("title","a");expect(b.eq(2)).toHaveAttr("title","b");expect(b.eq(3)).toHaveAttr("title","c");expect(b.eq(4)).toHaveAttr("title","d")});it("receives the number of the star when is null",function(){var a=$("#element");a.raty({hints:[null,"a","b","c","d"]});var b=a.children("img");expect(b.eq(0)).toHaveAttr("title",1);expect(b.eq(1)).toHaveAttr("title","a");expect(b.eq(2)).toHaveAttr("title","b");expect(b.eq(3)).toHaveAttr("title","c");expect(b.eq(4)).toHaveAttr("title","d")});context("whe has less hint than stars",function(){it("receives the default hint index",function(){var a=$("#element");a.raty({hints:["1","2","3","4"]});var b=a.children("img");expect(b.eq(0)).toHaveAttr("title",1);expect(b.eq(1)).toHaveAttr("title",2);expect(b.eq(2)).toHaveAttr("title",3);expect(b.eq(3)).toHaveAttr("title",4);expect(b.eq(4)).toHaveAttr("title","gorgeous")})});context("whe has more stars than hints",function(){it("sets star number",function(){var a=$("#element");a.raty({number:6,hints:["a","b","c","d","e"]});var b=a.children("img");expect(b.eq(0)).toHaveAttr("title","a");expect(b.eq(1)).toHaveAttr("title","b");expect(b.eq(2)).toHaveAttr("title","c");expect(b.eq(3)).toHaveAttr("title","d");expect(b.eq(4)).toHaveAttr("title","e");expect(b.eq(5)).toHaveAttr("title",6)})})});describe("#mouseover",function(){it("receives the score as int",function(){var a=$("#element").raty({mouseover:function(b){$(this).data("score",b)}});a.children("img:first").mouseover();expect(a.data("score")).toEqual(1)});it("receives the event",function(){var a=$("#element").raty({mouseover:function(c,b){$(this).data("evt",b)}});a.children("img:first").mouseover();expect(a.data("evt").type).toEqual("mouseover")});context("with :cancel",function(){it("receives null as score",function(){var a=$("#element").raty({cancel:true,mouseover:function(b){a.data("null",b)}});a.children(".raty-cancel").mouseover();expect(a.data("null")).toBeNull()})})});describe("#mouseout",function(){it("receives the score as int",function(){var a=$("#element").raty({mouseout:function(b){$(this).data("score",b)}});a.children("img:first").mouseover().click().mouseout();expect(a.data("score")).toEqual(1)});it("receives the event",function(){var a=$("#element").raty({mouseout:function(c,b){$(this).data("evt",b)}});a.children("img:first").mouseover().click().mouseout();expect(a.data("evt").type).toEqual("mouseout")});context("without score setted",function(){it("pass undefined on callback",function(){var a=$("#element").raty({cancel:true,mouseout:function(b){a.data("undefined",b===undefined)}});a.children("img:first").mouseenter().mouseleave();expect(a.data("undefined")).toBeTruthy()})});context("with :score rated",function(){it("pass the score on callback",function(){var a=$("#element").raty({score:1,mouseout:function(b){a.data("score",b)}});a.children("img:first").mouseenter().mouseleave();expect(a.data("score")).toEqual(1)})});context("with :cancel",function(){it("receives the event",function(){var a=$("#element").raty({cancel:true,mouseout:function(c,b){$(this).data("evt",b)}});a.children(".raty-cancel").mouseover().click().mouseout();expect(a.data("evt").type).toEqual("mouseout")});context("without score setted",function(){it("pass undefined on callback",function(){var a=$("#element").raty({mouseout:function(b){a.data("undefined",b===undefined)},cancel:true});a.children(".raty-cancel").mouseenter().mouseleave();expect(a.data("undefined")).toBeTruthy()})});context("with :score rated",function(){it("pass the score on callback",function(){var a=$("#element").raty({mouseout:function(b){a.data("score",b)},cancel:true,score:1});a.children(".raty-cancel").mouseenter().mouseleave();expect(a.data("score")).toEqual(1)})})})});describe("#number",function(){it("changes the number of stars",function(){var a=$("#element");a.raty({number:1});expect(a.children("img").length).toEqual(1)});it("accepts number as string",function(){var a=$("#element");a.raty({number:"10"});expect(a.children("img").length).toEqual(10)});it("accepts callback",function(){var a=$("#element");a.raty({number:function(){return 1}});expect(a.children("img").length).toEqual(1)})});describe("#path",function(){context("without last slash",function(){it("receives the slash",function(){var a=$("#element");a.raty({path:"path"});expect(a[0].opt.path).toEqual("path/")})});context("with last slash",function(){it("keeps it",function(){var a=$("#element");a.raty({path:"path/"});expect(a[0].opt.path).toEqual("path/")})});it("changes the path",function(){var a=$("#element");a.raty({path:"path"});expect(a.children("img")).toHaveAttr("src","path/star-off.png")});context("without path",function(){it("sets receives empty",function(){var a=$("#element");a.raty({path:null});expect(a.children("img")).toHaveAttr("src","star-off.png")})});context("with :cancel",function(){it("changes the path",function(){var a=$("#element");a.raty({cancel:true,path:"path"});expect(a.children(".raty-cancel")).toHaveAttr("src","path/cancel-off.png")})});context("with :iconRange",function(){it("changes the path",function(){var a=$("#element");a.raty({path:"path",iconRange:[{range:5}]});expect(a.children("img")).toHaveAttr("src","path/star-off.png")})})});describe("#cancelOff",function(){it("changes the icon",function(){var a=$("#element");a.raty({cancel:true,cancelOff:"off.png"});expect(a.children(".raty-cancel")).toHaveAttr("src","off.png")})});describe("#cancelOn",function(){it("changes the icon",function(){var a=$("#element").raty({cancel:true,cancelOn:"icon.png"});var b=a.children(".raty-cancel").mouseover();expect(b).toHaveAttr("src","icon.png")})});describe("#cancelHint",function(){it("changes the cancel hint",function(){var a=$("#element");a.raty({cancel:true,cancelHint:"hint"});expect(a.children(".raty-cancel")).toHaveAttr("title","hint")})});describe("#cancelPlace",function(){it("changes the place off cancel button",function(){var a=$("#element");a.raty({cancel:true,cancelPlace:"right"});var b=a.children("img:last");expect(b).toHaveClass("raty-cancel");expect(b).toHaveAttr("title","Cancel this rating!");expect(b).toHaveAttr("alt","x");expect(b).toHaveAttr("src","cancel-off.png")})});describe("#cancel",function(){it("creates the element",function(){var a=$("#element");a.raty({cancel:true});var b=a.children(".raty-cancel");expect(b).toHaveClass("raty-cancel");expect(b).toHaveAttr("title","Cancel this rating!");expect(b).toHaveAttr("alt","x");expect(b).toHaveAttr("src","cancel-off.png")});context("on mouseover",function(){it("turns on",function(){var a=$("#element").raty({cancel:true});var b=a.children(".raty-cancel").mouseover();expect(b).toHaveAttr("src","cancel-on.png")});context("with :score",function(){it("turns off the stars",function(){var a=$("#element").raty({score:3,cancel:true}),b=a.children("img:not(.raty-cancel)");a.children(".raty-cancel").mouseover();expect(b).toHaveAttr("src","star-off.png")})})});context("when :mouseout",function(){it("turns on",function(){var a=$("#element").raty({cancel:true});var b=a.children(".raty-cancel").mouseover().mouseout();expect(b).toHaveAttr("src","cancel-off.png")});context("with :score",function(){it("turns the star on again",function(){var a=$("#element").raty({score:4,cancel:true}),b=a.children("img:not(.raty-cancel)");a.children(".raty-cancel").mouseover().mouseout();expect(b.eq(0)).toHaveAttr("src","star-on.png");expect(b.eq(1)).toHaveAttr("src","star-on.png");expect(b.eq(2)).toHaveAttr("src","star-on.png");expect(b.eq(3)).toHaveAttr("src","star-on.png");expect(b.eq(4)).toHaveAttr("src","star-off.png")})})});context("on click",function(){it("cancel the rating",function(){var b=$("#element").raty({cancel:true,score:1});b.children(".raty-cancel").click().mouseout();var a=b.children("img:not(.raty-cancel)");expect(a).toHaveAttr("src","star-off.png");expect(b.children("input").val()).toEqual("")})});context("when starts :readOnly",function(){it("starts hidden",function(){var a=$("#element").raty({cancel:true,readOnly:true,path:"../img"});a.raty("readOnly",true);expect(a.children(".raty-cancel")).toBeHidden()});context("on click",function(){it("does not cancel the rating",function(){var b=$("#element").raty({cancel:true,readOnly:true,score:5});b.children(".raty-cancel").click().mouseout();var a=b.children("img:not(.raty-cancel)");expect(a).toHaveAttr("src","star-on.png");expect(b.children("input").val()).toEqual("5")})})});context("when become :readOnly",function(){it("becomes hidden",function(){var a=$("#element").raty({cancel:true,path:"../img"});a.raty("readOnly",true);expect(a.children(".raty-cancel")).toBeHidden()})})});describe("#targetType",function(){beforeEach(function(){buildDivTarget()});context("with missing target",function(){it("throws error",function(){var b=$("#element");var a=function(){b.raty({target:"missing"})};expect(a).toThrow(new Error("Target selector invalid or missing!"))})});context("as hint",function(){it("receives the hint",function(){var a=$("#element").raty({target:"#hint",targetType:"hint"});a.children("img:first").mouseover();expect($("#hint")).toHaveHtml("bad")});context("with :cancel",function(){it("receives the :cancelHint",function(){var a=$("#element").raty({cancel:true,target:"#hint",targetType:"hint"});a.children(".raty-cancel").mouseover();expect($("#hint")).toHaveHtml("Cancel this rating!")})})});context("as score",function(){it("receives the score",function(){var a=$("#element").raty({target:"#hint",targetType:"score"});a.children("img:first").mouseover();expect($("#hint")).toHaveHtml(1)});context("with :cancel",function(){it("receives the :cancelHint",function(){var a=$("#element").raty({cancel:true,target:"#hint",targetType:"score"});a.children(".raty-cancel").mouseover();expect($("#hint")).toHaveHtml("Cancel this rating!")})})})});describe("#targetText",function(){beforeEach(function(){buildDivTarget()});it("set target with none value",function(){var a=$("#element");a.raty({target:"#hint",targetText:"none"});expect($("#hint")).toHaveHtml("none")})});describe("#targetFormat",function(){context("with :target",function(){beforeEach(function(){buildDivTarget()});it("stars empty",function(){var a=$("#element");a.raty({target:"#hint",targetFormat:"score: {score}"});expect($("#hint")).toBeEmpty()});context("with missing score key",function(){it("throws error",function(){var b=$("#element");var a=function(){b.raty({target:"#hint",targetFormat:""})};expect(a).toThrow(new Error('Template "{score}" missing!'))})});context("on mouseover",function(){it("set target with format on mouseover",function(){var a=$("#element").raty({target:"#hint",targetFormat:"score: {score}"});a.children("img:first").mouseover();expect($("#hint")).toHaveHtml("score: bad")})});context("on mouseout",function(){it("clears the target",function(){var a=$("#element").raty({target:"#hint",targetFormat:"score: {score}"});a.children("img:first").mouseover().mouseout();expect($("#hint")).toBeEmpty()});context("with :targetKeep",function(){context("without score",function(){it("clears the target",function(){var a=$("#element").raty({target:"#hint",targetFormat:"score: {score}",targetKeep:true});a.children("img:first").mouseover().mouseleave();expect($("#hint")).toBeEmpty()})});context("with score",function(){it("keeps the template",function(){var a=$("#element").raty({score:1,target:"#hint",targetFormat:"score: {score}",targetKeep:true});a.children("img:first").mouseover().mouseleave();expect($("#hint")).toHaveHtml("score: bad")})})})})})});describe("#precision",function(){beforeEach(function(){buildDivTarget()});it("enables the :half options",function(){var a=$("#element");a.raty({precision:true});expect(a.data("settings").half).toBeTruthy()});it("changes the :targetType to score",function(){var a=$("#element");a.raty({precision:true});expect(a.data("settings").targetType).toEqual("score")});context("with :target",function(){context("with :targetKeep",function(){context("with :score",function(){it("sets the float with one fractional number",function(){var a=$("#element");a.raty({precision:true,score:1.23,target:"#hint",targetKeep:true,targetType:"score"});expect($("#hint")).toHaveHtml("1.2")})})})})});describe("#target",function(){context("on mouseover",function(){context("as div",function(){beforeEach(function(){buildDivTarget()});it("sets the hint",function(){var a=$("#element").raty({target:"#hint"});a.children("img:first").mouseover();expect($("#hint")).toHaveHtml("bad")})});context("as text field",function(){beforeEach(function(){buildTextTarget()});it("sets the hint",function(){var a=$("#element").raty({target:"#hint"});a.children("img:first").mouseover();expect($("#hint")).toHaveValue("bad")})});context("as textarea",function(){beforeEach(function(){buildTextareaTarget()});it("sets the hint",function(){var a=$("#element").raty({target:"#hint"});a.children("img:first").mouseover();expect($("#hint")).toHaveValue("bad")})});context("as combobox",function(){beforeEach(function(){buildComboboxTarget()});it("sets the hint",function(){var a=$("#element").raty({target:"#hint"});a.children("img:first").mouseover();expect($("#hint")).toHaveValue("bad")})})});context("on mouseout",function(){context("as div",function(){beforeEach(function(){buildDivTarget()});it("gets clear",function(){var a=$("#element").raty({target:"#hint"});a.children("img:first").mouseover().click().mouseleave();expect($("#hint")).toBeEmpty()})});context("as textarea",function(){beforeEach(function(){buildTextareaTarget()});it("gets clear",function(){var a=$("#element").raty({target:"#hint"});a.children("img:first").click().mouseover().mouseleave();expect($("#hint")).toHaveValue("")})});context("as text field",function(){beforeEach(function(){buildTextTarget()});it("gets clear",function(){var a=$("#element").raty({target:"#hint"});a.children("img:first").click().mouseover().mouseleave();expect($("#hint")).toHaveValue("")})});context("as combobox",function(){beforeEach(function(){buildComboboxTarget()});it("gets clear",function(){var a=$("#element").raty({target:"#hint"});a.children("img:first").click().mouseover().mouseleave();expect($("#hint")).toHaveValue("")})})})});describe("#size",function(){it("calculate the right icon size",function(){var b=$("#element"),c=24,a=5,d=4;b.raty({size:c});expect(b.width()).toEqual((a*c)+(a*d))});context("with :cancel",function(){it("addes the cancel and space witdh",function(){var b=$("#element"),c=24,a=5,d=c,e=4;b.raty({cancel:true,size:c});expect(b.width()).toEqual(d+e+(a*c)+(a*e))})})});describe("#space",function(){context("when off",function(){it("takes off the space",function(){var a=$("#element");size=16,stars=5;a.raty({space:false});expect(a.width()).toEqual(size*stars)});context("with :cancel",function(){it("takes off the space",function(){var a=$("#element");size=16,stars=5,cancel=size;a.raty({cancel:true,space:false});expect(a.width()).toEqual(cancel+(size*stars))})})})});describe("#single",function(){context("on mouseover",function(){it("turns on just one icon",function(){var a=$("#element").raty({single:true}),b=a.children("img");b.eq(2).mouseover();expect(b.eq(0)).toHaveAttr("src","star-off.png");expect(b.eq(1)).toHaveAttr("src","star-off.png");expect(b.eq(2)).toHaveAttr("src","star-on.png");expect(b.eq(3)).toHaveAttr("src","star-off.png");expect(b.eq(4)).toHaveAttr("src","star-off.png")});context("with :iconRange",function(){it("shows just on icon",function(){var a=$("#element").raty({single:true,iconRange:[{range:2,on:"a.png",off:"a-off.png"},{range:3,on:"b.png",off:"b-off.png"},{range:4,on:"c.png",off:"c-off.png"},{range:5,on:"d.png",off:"d-off.png"}]}),b=a.children("img");b.eq(3).mouseover();expect(b.eq(0)).toHaveAttr("src","a-off.png");expect(b.eq(1)).toHaveAttr("src","a-off.png");expect(b.eq(2)).toHaveAttr("src","b-off.png");expect(b.eq(3)).toHaveAttr("src","c.png");expect(b.eq(4)).toHaveAttr("src","d-off.png")})})});context("on click",function(){context("on mouseout",function(){it("keeps the score",function(){var a=$("#element").raty({single:true});imgs=a.children("img");imgs.eq(2).mouseover().click().mouseleave();expect(imgs.eq(0)).toHaveAttr("src","star-off.png");expect(imgs.eq(1)).toHaveAttr("src","star-off.png");expect(imgs.eq(2)).toHaveAttr("src","star-on.png");expect(imgs.eq(3)).toHaveAttr("src","star-off.png");expect(imgs.eq(4)).toHaveAttr("src","star-off.png")});context("and :iconRange",function(){it("keeps the score",function(){var a=$("#element").raty({single:true,iconRange:[{range:2,on:"a.png",off:"a-off.png"},{range:3,on:"b.png",off:"b-off.png"},{range:4,on:"c.png",off:"c-off.png"},{range:5,on:"d.png",off:"d-off.png"}]}),b=a.children("img");b.eq(3).mouseover().click().mouseleave();expect(b.eq(0)).toHaveAttr("src","a-off.png");expect(b.eq(1)).toHaveAttr("src","a-off.png");expect(b.eq(2)).toHaveAttr("src","b-off.png");expect(b.eq(3)).toHaveAttr("src","c.png");expect(b.eq(4)).toHaveAttr("src","d-off.png")})})})})});describe("#width",function(){it("set custom width",function(){var a=$("#element");a.raty({width:200});expect(a.width()).toEqual(200)});describe("when it is false",function(){it("does not apply the style",function(){var a=$("#element");a.raty({width:false});expect(a).not.toHaveCss({width:"100px"})})});describe("when :readOnly",function(){it("set custom width when readOnly",function(){var a=$("#element");a.raty({readOnly:true,width:200});expect(a.width()).toEqual(200)})})});describe("#half",function(){context("as false",function(){context("#halfShow",function(){context("as false",function(){it("rounds down while less the full limit",function(){var a=$("#element");a.raty({half:false,halfShow:false,round:{down:0.25,full:0.6,up:0.76},score:0.5});var b=a.children("img");expect(b.eq(0)).toHaveAttr("src","star-off.png");expect(b.eq(1)).toHaveAttr("src","star-off.png")});it("rounds full when equal the full limit",function(){var a=$("#element");a.raty({half:false,halfShow:false,round:{down:0.25,full:0.6,up:0.76},score:0.6});var b=a.children("img");expect(b.eq(0)).toHaveAttr("src","star-on.png")})})})});context("as true",function(){context("#halfShow",function(){context("as false",function(){it("ignores round down while less down limit",function(){var a=$("#element");a.raty({half:true,halfShow:false,round:{down:0.25,full:0.6,up:0.76},score:0.24});var b=a.children("img");expect(b.eq(0)).toHaveAttr("src","star-off.png");expect(a.children("input").val()).toEqual("0.24")});it("ignores half while greater then down limit",function(){var a=$("#element");a.raty({half:true,halfShow:false,round:{down:0.25,full:0.6,up:0.76},score:0.26});var b=a.children("img");expect(b.eq(0)).toHaveAttr("src","star-off.png");expect(a.children("input").val()).toEqual("0.26")});it("ignores half while equal full limit, ignoring it",function(){var a=$("#element");a.raty({half:true,halfShow:false,round:{down:0.25,full:0.6,up:0.76},score:0.6});var b=a.children("img");expect(b.eq(0)).toHaveAttr("src","star-on.png");expect(a.children("input").val()).toEqual("0.6")});it("ignores half while greater than down limit and less than up limit",function(){var a=$("#element");a.raty({half:true,halfShow:false,round:{down:0.25,full:0.6,up:0.76},score:0.75});var b=a.children("img");expect(b.eq(0)).toHaveAttr("src","star-on.png");expect(a.children("input").val()).toEqual("0.75")});it("ignores full while equal or greater than up limit",function(){var a=$("#element");a.raty({half:true,halfShow:false,round:{down:0.25,full:0.6,up:0.76},score:0.76});var b=a.children("img");expect(b.eq(0)).toHaveAttr("src","star-on.png")})});context("as true",function(){it("rounds down while less down limit",function(){var a=$("#element");a.raty({half:true,halfShow:true,round:{down:0.25,full:0.6,up:0.76},score:0.24});var b=a.children("img");expect(b.eq(0)).toHaveAttr("src","star-off.png")});it("receives half while greater then down limit",function(){var a=$("#element");a.raty({half:true,halfShow:true,round:{down:0.25,full:0.6,up:0.76},score:0.26});var b=a.children("img");expect(b.eq(0)).toHaveAttr("src","star-half.png")});it("receives half while equal full limit, ignoring it",function(){var a=$("#element");a.raty({half:true,halfShow:true,round:{down:0.25,full:0.6,up:0.76},score:0.6});var b=a.children("img");expect(b.eq(0)).toHaveAttr("src","star-half.png")});it("receives half while greater than down limit and less than up limit",function(){var a=$("#element");a.raty({half:true,halfShow:true,round:{down:0.25,full:0.6,up:0.76},score:0.75});var b=a.children("img");expect(b.eq(0)).toHaveAttr("src","star-half.png")});it("receives full while equal or greater than up limit",function(){var a=$("#element");a.raty({half:true,halfShow:true,round:{down:0.25,full:0.6,up:0.76},score:0.76});var b=a.children("img");expect(b.eq(0)).toHaveAttr("src","star-on.png")})})});context("with :target",function(){beforeEach(function(){buildDivTarget()});context("and :precision",function(){context("and :targetType as score",function(){context("and :targetKeep",function(){context("and :targetType as score",function(){it("set .5 increment value target with half option and no precision",function(){var a=$("#element");a.raty({half:true,precision:false,score:1.5,target:"#hint",targetKeep:true,targetType:"score"});expect($("#hint")).toHaveHtml("1.5")})})})})})})})})});describe("class bind",function(){beforeEach(function(){$("body").append('<div class="element"></div><div class="element"></div>')});afterEach(function(){$(".element").remove()});it("is chainable",function(){var b=$(".element");var a=b.raty();expect(a.eq(0)).toBe(b.eq(0));expect(a.eq(1)).toBe(b.eq(1))});it("creates the default markup",function(){var a=$(".element");a.raty();var c=a.eq(0).children("img"),b=a.eq(0).children("input");expect(c.eq(0)).toHaveAttr("title","bad");expect(c.eq(1)).toHaveAttr("title","poor");expect(c.eq(2)).toHaveAttr("title","regular");expect(c.eq(3)).toHaveAttr("title","good");expect(c.eq(4)).toHaveAttr("title","gorgeous");expect(c).toHaveAttr("src","star-off.png");expect(b).toHaveAttr("type","hidden");expect(b).toHaveAttr("name","score");expect(b.val()).toEqual("");c=a.eq(1).children("img");b=a.eq(0).children("input");expect(c.eq(0)).toHaveAttr("title","bad");expect(c.eq(1)).toHaveAttr("title","poor");expect(c.eq(2)).toHaveAttr("title","regular");expect(c.eq(3)).toHaveAttr("title","good");expect(c.eq(4)).toHaveAttr("title","gorgeous");expect(c).toHaveAttr("src","star-off.png");expect(b).toHaveAttr("type","hidden");expect(b).toHaveAttr("name","score");expect(b.val()).toEqual("")})});describe("functions",function(){describe("GET #score",function(){it("accepts number as string",function(){var a=$("#element");a.raty({score:"1"});expect(a.children("input")).toHaveValue(1)});it("accepts float string",function(){var a=$("#element");a.raty({score:"1.5"});expect(a.children("input")).toHaveValue(1.5)});context("with integer score",function(){it("gets as int",function(){var a=$("#element").raty({score:1});var b=a.raty("score");expect(b).toEqual(1)})});context("with float score",function(){it("gets as float",function(){var a=$("#element").raty({score:1.5});var b=a.raty("score");expect(b).toEqual(1.5)})});context("with score zero",function(){it("gets null to emulate cancel",function(){var a=$("#element").raty({score:0});var b=a.raty("score");expect(b).toEqual(null)})});context("with score greater than :numberMax",function(){it("gets the max",function(){var a=$("#element").raty({number:50,score:50});var b=a.raty("score");expect(b).toEqual(a.data("settings").numberMax)})})});describe("SET #score",function(){it("sets the score",function(){var a=$("#element");a.raty({score:1});expect(a.raty("score")).toEqual(1)});describe("with :click",function(){it("calls the click callback",function(){var a=$("#element").raty({click:function(b){$(this).data("score",b)}});a.raty("score",5);expect(a.children("img")).toHaveAttr("src","star-on.png")})});describe("without :click",function(){it("does not throw exception",function(){var b=$("#element").raty();var a=function(){b.raty("score",1)};expect(a).not.toThrow(new Error('You must add the "click: function(score, evt) { }" callback.'))})});describe("with :readOnly",function(){it("does not set the score",function(){var a=$("#element").raty({readOnly:true});a.raty("score",5);expect(a.children("img")).toHaveAttr("src","star-off.png")})})});describe("#set",function(){it("is chainable",function(){var a=$("#element").raty();var b=a.raty("set",{number:1});expect(b).toBe(a)});it("changes the declared options",function(){var a=$("#element").raty();var b=a.raty("set",{scoreName:"change-just-it"});expect(b.children("input")).toHaveAttr("name","change-just-it")});it("does not change other none declared options",function(){var a=$("#element").raty({number:6});var b=a.raty("set",{scoreName:"change-just-it"});expect(b.children("img").length).toEqual(6)});context("with external bind on wrapper",function(){it("keeps it",function(){var a=$("#element").on("click",function(){$(this).data("externalClick",true)}).raty();a.raty("set",{}).click();expect(a.data("externalClick")).toBeTruthy()})});context("when :readOnly by function",function(){it("is removes the readonly data info",function(){var a=$("#element").raty().raty("readOnly",true);var b=a.raty("set",{readOnly:false});expect(a).not.toHaveData("readonly")})})});describe("#readOnly",function(){context("changes to true",function(){it("sets score as readonly",function(){var a=$("#element").raty();a.raty("readOnly",true);expect(a.children("input")).toHaveAttr("readonly","readonly")});it("removes the pointer cursor",function(){var a=$("#element").raty();a.raty("readOnly",true);expect(a).not.toHaveCss({cursor:"pointer"});expect(a).not.toHaveCss({cursor:"default"})});it('Applies "Not rated yet!" on stars',function(){var a=$("#element").raty();a.raty("readOnly",true);expect(a.children("img")).toHaveAttr("title","Not rated yet!")});it("avoids trigger mouseover",function(){var a=$("#element").raty(),b=a.children("img");a.raty("readOnly",true);b.eq(0).mouseover();expect(b).toHaveAttr("src","star-off.png")});it("avoids trigger click",function(){var a=$("#element").raty(),b=a.children("img");a.raty("readOnly",true);b.eq(0).mouseover().click().mouseleave();expect(b).toHaveAttr("src","star-off.png");expect(a.children("input").val()).toEqual("")});context("with :score",function(){it("applies the score title on stars",function(){var a=$("#element").raty({score:1});a.raty("readOnly",true);expect(a.children("img")).toHaveAttr("title","bad")})});context("with :cancel",function(){it("hides the button",function(){var a=$("#element").raty({cancel:true,path:"../lib/img"});a.raty("readOnly",true);expect(a.children(".raty-cancel")).toBeHidden()})});context("with external bind on wrapper",function(){it("keeps it",function(){var a=$("#element").on("click",function(){$(this).data("externalClick",true)}).raty();a.raty("readOnly",true).click();expect(a.data("externalClick")).toBeTruthy()})});context("with external bind on stars",function(){it("keeps it",function(){var a=$("#element").raty(),b=a.children("img").first();b.on("click",function(){a.data("externalClick",true)});a.raty("readOnly",true);b.click();expect(a.data("externalClick")).toBeTruthy()})})});context("changes to false",function(){it("removes the :readOnly of the score",function(){var a=$("#element").raty();a.raty("readOnly",false);expect(a.children("input")).not.toHaveAttr("readonly","readonly")});it("applies the pointer cursor on wrapper",function(){var a=$("#element").raty();a.raty("readOnly",false);expect(a).toHaveCss({cursor:"pointer"})});it('Removes the "Not rated yet!" off the stars',function(){var a=$("#element").raty({readOnly:true}),b=a.children("img");a.raty("readOnly",false);expect(b.eq(0)).toHaveAttr("title","bad");expect(b.eq(1)).toHaveAttr("title","poor");expect(b.eq(2)).toHaveAttr("title","regular");expect(b.eq(3)).toHaveAttr("title","good");expect(b.eq(4)).toHaveAttr("title","gorgeous")});it("triggers mouseover",function(){var a=$("#element").raty({readOnly:true}),b=a.children("img");a.raty("readOnly",false);b.eq(0).mouseover();expect(b.eq(0)).toHaveAttr("src","star-on.png")});it("triggers click",function(){var a=$("#element").raty({readOnly:true}),b=a.children("img");a.raty("readOnly",false);b.eq(0).mouseover().click().mouseleave();expect(b).toHaveAttr("src","star-on.png");expect(a.children("input")).toHaveValue("1")});context("with :score",function(){it("removes the score title off the stars",function(){var a=$("#element").raty({readOnly:true,score:3});a.raty("readOnly",false);var b=a.children("img");expect(b.eq(0)).toHaveAttr("title","bad");expect(b.eq(1)).toHaveAttr("title","poor");expect(b.eq(2)).toHaveAttr("title","regular");expect(b.eq(3)).toHaveAttr("title","good");expect(b.eq(4)).toHaveAttr("title","gorgeous")})});context("with :cancel",function(){it("shows the button",function(){var a=$("#element").raty({readOnly:true,cancel:true,path:"../lib/img"});a.raty("readOnly",false);expect(a.children(".raty-cancel")).toBeVisible();expect(a.children(".raty-cancel")).not.toHaveCss({display:"block"})});it("rebinds the mouseover",function(){var a=$("#element").raty({readOnly:true,cancel:true}),b=a.children(".raty-cancel"),c=a.children("img:not(.raty-cancel)");a.raty("readOnly",false);b.mouseover();expect(b).toHaveAttr("src","cancel-on.png");expect(c).toHaveAttr("src","star-off.png")});it("rebinds the click",function(){var a=$("#element").raty({readOnly:true,cancel:true,score:5}),b=a.children("img:not(.raty-cancel)");a.raty("readOnly",false);a.children(".raty-cancel").click().mouseout();expect(b).toHaveAttr("src","star-off.png")})})})});describe("#cancel",function(){describe("with :readOnly",function(){it("does not cancel",function(){var a=$("#element").raty({readOnly:true,score:5});a.raty("cancel");expect(a.children("img")).toHaveAttr("src","star-on.png")})});context("without click trigger",function(){it("cancel the rating",function(){var a=$("#element").raty({score:1,click:function(){$(this).data("clicked",true)}});a.raty("cancel");expect(a.children("img")).toHaveAttr("src","star-off.png");expect(a.children("input").val()).toEqual("");expect(a.data("clicked")).toBeFalsy()})});context("with click trigger",function(){it("cancel the rating",function(){var a=$("#element").raty({score:1,click:function(){$(this).data("clicked",true)}});a.raty("cancel",true);expect(a.children("img")).toHaveAttr("src","star-off.png");expect(a.children("input").val()).toEqual("");expect(a.data("clicked")).toBeTruthy()})});context("with :target",function(){beforeEach(function(){buildDivTarget()});context("and :targetKeep",function(){it("sets the :targetText on target",function(){var b=$("#hint").html("dirty"),a=$("#element").raty({cancel:true,target:"#hint",targetKeep:true,targetText:"targetText"});a.raty("cancel");expect(b).toHaveHtml("targetText")})})})});describe("#click",function(){it("clicks on star",function(){var a=$("#element").raty({click:function(){$(this).data("clicked",true)}});a.raty("click",1);expect(a.children("img")).toHaveAttr("src","star-on.png");expect(a.data("clicked")).toBeTruthy()});it("receives the score",function(){var a=$("#element").raty({click:function(b){$(this).data("score",b)}});a.raty("click",1);expect(a.data("score")).toEqual(1)});it("receives the event",function(){var a=$("#element").raty({click:function(c,b){$(this).data("evt",b)}});a.raty("click",1);expect(a.data("evt").type).toEqual("click")});describe("with :readOnly",function(){it("does not set the score",function(){var a=$("#element").raty({readOnly:true});a.raty("click",1);expect(a.children("img")).toHaveAttr("src","star-off.png")})});context("without :click",function(){it("throws error",function(){var b=$("#element").raty();var a=function(){b.raty("click",1)};expect(a).toThrow(new Error('You must add the "click: function(score, evt) { }" callback.'))})});context("with :target",function(){beforeEach(function(){buildDivTarget()});context("and :targetKeep",function(){it("sets the score on target",function(){var a=$("#element").raty({target:"#hint",targetKeep:true,click:function(){}});a.raty("click",1);expect($("#hint")).toHaveHtml("bad")})})})});describe("#reload",function(){it("is chainable",function(){var a=$("#element").raty();var b=a.raty("reload");expect(b).toBe(a)});it("reloads with the same configuration",function(){var a=$("#element").raty({number:6});var b=a.raty("reload");expect(b.children("img").length).toEqual(6)});context("when :readOnly by function",function(){it("is removes the readonly data info",function(){var a=$("#element").raty().raty("readOnly",true);var b=a.raty("reload");expect(a).not.toHaveData("readonly")})})});describe("#destroy",function(){it("is chainable",function(){var a=$("#element").raty();var b=a.raty("destroy");expect(b).toBe(a)});it("clear the content",function(){var a=$("#element").raty();a.raty("destroy");expect(a).toBeEmpty()});it("removes the trigger mouseleave",function(){var a=$("#element").raty({mouseout:function(){console.log(this);$(this).data("mouseleave",true)}});a.raty("destroy");a.mouseleave();expect(a.data("mouseleave")).toBeFalsy()});it("resets the style attributes",function(){var a=$("#element").css({cursor:"help",width:10}).raty();a.raty("destroy");expect(a[0].style.cursor).toEqual("help");expect(a[0].style.width).toEqual("10px")})})})});