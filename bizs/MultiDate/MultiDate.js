(function(f){window.Bizs.MultiDate=g;function g(a){if(g.getInstance(a)){return g.getInstance(a)}g.getInstance(a,this);this._model=new h(a);this._view=new e(this._model);this._init()}g.prototype={_init:function(){var a=this;f([a._view,a._model]).on("BindEvent",function(d,b,c){a.on(b,c)});f([a._view,a._model]).on("TriggerEvent",function(d,b){var c=sliceArgs(arguments);c.shift();c.shift();a.trigger(b,c)});a._model.init();a._view.init();a._initDefaultValue();a._initHandlerEvent();return a},_initDefaultValue:function(){var c=this,b=c._model.qstartdate(),a=c._model.qenddate();c._model.selector(c._model.qtype());c._model.mdstartdate(b);c._model.mdenddate(a);if(!c._model.mddate().attr("name")){if(b&&a){if(b==a){c._model.mddate(formatISODate(parseISODate(b)))}else{c._model.mddate(printf("{0} è‡³ {1}",formatISODate(parseISODate(b)),formatISODate(parseISODate(a))))}}}else{c._model.mddate(c._model.qdate())}},_initHandlerEvent:function(){var a=this;a._model.selector().on("change",function(b){var c=f(this);JC.log("type:",c.val());a._model.settype(c.val());setTimeout(function(){JC.Calendar.pickDate(a._model.mddate()[0]);a._model.mdstartdate("");a._model.mdenddate("")},10)})},selector:function(){return this._model.selector()},on:function(a,b){f(this).on(a,b);return this},trigger:function(a,b){f(this).trigger(a,b);return this}};g.getInstance=function(b,a){if(typeof b=="string"&&!/</.test(b)){b=f(b)}if(!(b&&b.length)||(typeof b=="string")){return}typeof a!="undefined"&&b.data("MultiDateIns",a);return b.data("MultiDateIns")};g.isMultiDate=function(b){var a;b&&(b=f(b)).length&&(a=b.is("[MultiDatelayout]"));return a};function h(a){this._selector=a}h._inscount=1;h.prototype={init:function(){var j=this,b="Bizs.MultiDate_"+(h._inscount),d="Bizs.MultiDate_show_"+(h._inscount),c="Bizs.MultiDate_hide_"+(h._inscount),a="Bizs.MultiDate_layoutchange_"+(h._inscount);h._inscount++;window[b]=function(m,n,i){j.mdstartdate(formatISODate(n,""));j.mdenddate(formatISODate(i,""))};j.mddate().attr("calendarupdate",b);window[d]=function(){var i=f("body > div.UXCCalendar:visible");i.length&&JC.Tips&&JC.Tips.init(i.find("[title]"))};j.mddate().attr("calendarshow",d);window[c]=function(){JC.Tips&&JC.Tips.hide();j.updateHiddenDate()};j.mddate().attr("calendarhide",c);window[a]=function(){JC.Tips&&JC.Tips.hide();var i=f("body > div.UXCCalendar:visible");i.length&&JC.Tips&&JC.Tips.init(i.find("[title]"))};j.mddate().attr("calendarlayoutchange",a);return j},selector:function(a){typeof a!="undefined"&&this.hastype(this.qtype())&&this._selector.val(a)&&this.settype(a);return this._selector},mddate:function(b){var a=parentSelector(this.selector(),this.selector().attr("mddate"));typeof b!="undefined"&&a.val(b);return a},mdstartdate:function(b){var a=parentSelector(this.selector(),this.selector().attr("mdstartdate"));typeof b!="undefined"&&a.val(b.replace(/[^\d]/g,""));return a},mdenddate:function(b){var a=parentSelector(this.selector(),this.selector().attr("mdenddate"));typeof b!="undefined"&&a.val(b.replace(/[^\d]/g,""));return a},qtype:function(){return this.decodedata(get_url_param(this.selector().attr("name")||"")||"").toLowerCase()},qdate:function(){return this.decodedata(get_url_param(this.mddate().attr("name")||"")||"").toLowerCase()},qstartdate:function(){return this.decodedata(get_url_param(this.mdstartdate().attr("name")||"")||"").toLowerCase()},qenddate:function(){return this.decodedata(get_url_param(this.mdenddate().attr("name")||"")||"").toLowerCase()},hastype:function(b){var a=false;this.selector().find("> option").each(function(){if(f(this).val().trim()==b){a=true;return false}});return a},settype:function(a){this.mddate().val("").attr("multidate",a)},decodedata:function(b){b=b.replace(/[\+]/g," ");try{b=decodeURIComponent(b)}catch(a){}return b},updateHiddenDate:function(){var a=f.trim(this.mddate().val());if(!a){this.mdstartdate("");this.mdenddate("");return}a=a.replace(/[^\d]+/g,"");if(a.length==8){this.mdstartdate(a);this.mdenddate(a)}if(a.length==16){this.mdstartdate(a.slice(0,8));this.mdenddate(a.slice(8))}}};function e(a){this._model=a}e.prototype={init:function(){return this},hide:function(){},show:function(){}};f(document).ready(function(){f("select.js_autoMultidate").each(function(){new g(f(this))})})}(jQuery));