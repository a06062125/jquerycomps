(function(a){window.Bizs.MultiDate=b;function b(c){if(b.getInstance(c)){return b.getInstance(c)}b.getInstance(c,this);this._model=new b.Model(c);this._view=new b.View(this._model);this._init()}b.prototype={_beforeInit:function(){JC.log("MultiDate _beforeInit",new Date().getTime())},_initHanlderEvent:function(){var c=this;a([c._view,c._model]).on("BindEvent",function(d,f,e){c.on(f,e)});a([c._view,c._model]).on("TriggerEvent",function(d,f){var e=sliceArgs(arguments);e.shift();e.shift();c.trigger(f,e)});c._initDefaultValue();c._initHandlerEvent();c.selector().trigger("change",[true])},_initDefaultValue:function(){var c=this,f=c._model.qstartdate(),g=c._model.qenddate(),e=c._model.mdCustomStartDate(),d=c._model.mdCustomEndDate();c._model.selector(c._model.qtype());c._model.mdstartdate(f);c._model.mdenddate(g);if(!c._model.mddate().attr("name")){if(f&&g){if(f==g){c._model.mddate(formatISODate(parseISODate(f)))}else{c._model.mddate(printf("{0} è‡³ {1}",formatISODate(parseISODate(f)),formatISODate(parseISODate(g))))}}}else{c._model.mddate(c._model.qdate())}e&&e.length&&e.val(f?formatISODate(parseISODate(f)):f);d&&d.length&&d.val(g?formatISODate(parseISODate(g)):g)},_initHandlerEvent:function(){var c=this;c._model.selector().on("change",function(f,i){var d=a(this),h=d.val().trim().toLowerCase(),g=c._model.mdDefaultBox(),e=c._model.mdCustomBox();JC.log("type:",h);if(h=="custom"){if(g&&e&&g.length&&e.length){g.hide();g.find("input").prop("disabled",true);e.find("input").prop("disabled",false);e.show()}}else{if(g&&e&&g.length&&e.length){e.hide();e.find("input").prop("disabled",true);g.find("input").prop("disabled",false);g.show()}if(i){return}c._model.settype(h);setTimeout(function(){JC.Calendar.pickDate(c._model.mddate()[0]);c._model.mdstartdate("");c._model.mdenddate("")},10)}})},_inited:function(){JC.log("MultiDate _inited",new Date().getTime())}};b.getInstance=function(c,d){if(typeof c=="string"&&!/</.test(c)){c=a(c)}if(!(c&&c.length)||(typeof c=="string")){return}typeof d!="undefined"&&c.data(b.Model._instanceName,d);return c.data(b.Model._instanceName)};b.isMultiDate=function(c){var d;c&&(c=a(c)).length&&(d=c.is("[MultiDatelayout]"));return d};BaseMVC.buildModel(b);b.Model._instanceName="MultiDate";b.Model._inscount=1;b.Model.prototype={init:function(){var c=this,f="Bizs.MultiDate_"+(b.Model._inscount),d="Bizs.MultiDate_show_"+(b.Model._inscount),e="Bizs.MultiDate_hide_"+(b.Model._inscount),g="Bizs.MultiDate_layoutchange_"+(b.Model._inscount);b.Model._inscount++;window[f]=function(i,h,j){c.mdstartdate(formatISODate(h,""));c.mdenddate(formatISODate(j,""))};c.mddate().attr("calendarupdate",f);window[d]=function(){var h=a("body > div.UXCCalendar:visible");h.length&&JC.Tips&&JC.Tips.init(h.find("[title]"))};c.mddate().attr("calendarshow",d);window[e]=function(){JC.Tips&&JC.Tips.hide();c.updateHiddenDate()};c.mddate().attr("calendarhide",e);window[g]=function(){JC.Tips&&JC.Tips.hide();var h=a("body > div.UXCCalendar:visible");h.length&&JC.Tips&&JC.Tips.init(h.find("[title]"))};c.mddate().attr("calendarlayoutchange",g);return c},mdDefaultBox:function(){return this.selectorProp("mdDefaultBox")},mdCustomBox:function(){return this.selectorProp("mdCustomBox")},mdCustomStartDate:function(){return this.selectorProp("mdCustomStartDate")},mdCustomEndDate:function(){return this.selectorProp("mdCustomEndDate")},selector:function(c){typeof c!="undefined"&&this.hastype(this.qtype())&&this._selector.val(c)&&this.settype(c);return this._selector},mddate:function(c){var d=parentSelector(this.selector(),this.selector().attr("mddate"));typeof c!="undefined"&&d.val(c);return d},mdstartdate:function(c){var d=parentSelector(this.selector(),this.selector().attr("mdstartdate"));typeof c!="undefined"&&d.val(c.replace(/[^\d]/g,""));return d},mdenddate:function(c){var d=parentSelector(this.selector(),this.selector().attr("mdenddate"));typeof c!="undefined"&&d.val(c.replace(/[^\d]/g,""));return d},qtype:function(){return this.decodedata(get_url_param(this.selector().attr("name")||"")||"").toLowerCase()},qdate:function(){return this.decodedata(get_url_param(this.mddate().attr("name")||"")||"").toLowerCase()},qstartdate:function(){return this.decodedata(get_url_param(this.mdstartdate().attr("name")||"")||"").toLowerCase()},qenddate:function(){return this.decodedata(get_url_param(this.mdenddate().attr("name")||"")||"").toLowerCase()},hastype:function(c){var d=false;this.selector().find("> option").each(function(){if(a(this).val().trim()==c){d=true;return false}});return d},settype:function(c){this.mddate().val("").attr("multidate",c)},decodedata:function(c){c=c.replace(/[\+]/g," ");try{c=decodeURIComponent(c)}catch(d){}return c},updateHiddenDate:function(){var c=a.trim(this.mddate().val());if(!c){this.mdstartdate("");this.mdenddate("");return}c=c.replace(/[^\d]+/g,"");if(c.length==8){this.mdstartdate(c);this.mdenddate(c)}if(c.length==16){this.mdstartdate(c.slice(0,8));this.mdenddate(c.slice(8))}}};BaseMVC.buildView(b);b.View.prototype={init:function(){return this},hide:function(){},show:function(){}};BaseMVC.build(b,"Bizs");a(document).ready(function(){a("select.js_autoMultidate").each(function(){new b(a(this))})})}(jQuery));