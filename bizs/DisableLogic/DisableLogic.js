(function(a){window.Bizs.DisableLogic=d;function d(e){if(d.getInstance(e)){return d.getInstance(e)}d.getInstance(e,this);JC.log("Bizs.DisableLogic:",new Date().getTime());this._model=new c(e);this._view=new b(this._model);this._init()}d.prototype={_init:function(){var e=this,f;e._initHandlerEvent();a([e._view,e._model]).on("BindEvent",function(g,i,h){e.on(i,h)});a([e._view,e._model]).on("TriggerEvent",function(g,i){var h=sliceArgs(arguments).slice(2);e.trigger(i,h)});e._model.init();e._view.init();e._model.dltrigger().on("change",function(g){JC.log("dltrigger change",new Date().getTime());e._view.change(this)});(f=e._model.dltrigger(true))&&f.trigger("change");return e},_initHandlerEvent:function(){var e=this;e.on("DisableItem",function(g,f){e._model.dldisablecallback()&&e._model.dldisablecallback().call(e,f,e._model.selector())});e.on("EnableItem",function(g,f){e._model.dlenablecallback()&&e._model.dlenablecallback().call(e,f,e._model.selector())});e.on("ChangeDone",function(g,f){e._model.dldonecallback()&&e._model.dldonecallback().call(e,f,e._model.selector())})},selector:function(){return this._model.selector()},on:function(f,e){a(this).on(f,e);return this},trigger:function(f,e){a(this).trigger(f,e);return this}};d.getInstance=function(e,f){if(typeof e=="string"&&!/</.test(e)){e=a(e)}if(!(e&&e.length)||(typeof e=="string")){return}typeof f!="undefined"&&e.data("DisableLogicIns",f);return e.data("DisableLogicIns")};d.doneCallback=null;d.enableCallback=null;d.disableCallback=null;d.init=function(e){e=a(e||document);e.find(["div.js_bizsDisableLogic","dl.js_bizsDisableLogic","table.js_bizsDisableLogic"].join()).each(function(){new d(a(this))})};function c(e){this._selector=e}c.prototype={init:function(){return this},selector:function(){return this._selector},dltrigger:function(f){var e=this,h=parentSelector(this.selector(),this.selector().attr("dltrigger")),g;if(f){h.each(function(){g=a(this);if(g.prop("checked")||g.prop("selected")){h=g;return false}})}return h},dltarget:function(f){var e=this,h,g;e.selector().attr("dltarget")&&(h=parentSelector(e.selector(),e.selector().attr("dltarget")));f&&(f=a(f)).length&&f.attr("dltrigger")&&(h=parentSelector(f,f.attr("dltarget")));return h},dldisable:function(e){var f=false;e&&(e=a(e)).length&&e.is("[dldisable]")&&(f=parseBool(e.attr("dldisable")));if(e.prop("nodeName").toLowerCase()=="input"&&e.attr("type").toLowerCase()=="checkbox"){f=!e.prop("checked")}return f},dldisplay:function(e){var f=false;if(!e.is("[dldisplay]")){(e=a(e)).length&&e.is("[dldisable]")&&(f=!parseBool(e.attr("dldisable")))}else{(e=a(e)).length&&e.is("[dldisplay]")&&(f=parseBool(e.attr("dldisplay")))}if(e.prop("nodeName").toLowerCase()=="input"&&e.attr("type").toLowerCase()=="checkbox"){f=e.prop("checked")}return f},dlhidetarget:function(f){var e=this,h,g;e.selector().attr("dlhidetarget")&&(h=parentSelector(e.selector(),e.selector().attr("dlhidetarget")));f&&(f=a(f)).length&&f.attr("dlhidetarget")&&(h=parentSelector(f,f.attr("dlhidetarget")));return h},dlhidetoggle:function(e){var f;e&&e.is("[dlhidetoggle]")&&(f=parseBool(e.attr("dlhidetoggle")));return f},dldonecallback:function(){var f=d.doneCallback,e;this.selector()&&(e=this.selector().attr("dldonecallback"))&&(e=window[e])&&(f=e);return f},dlenablecallback:function(){var f=d.enableCallback,e;this.selector()&&(e=this.selector().attr("dlenablecallback"))&&(e=window[e])&&(f=e);return f},dldisablecallback:function(){var f=d.disableCallback,e;this.selector()&&(e=this.selector().attr("dldisablecallback"))&&(e=window[e])&&(f=e);return f}};function b(e){this._model=e}b.prototype={init:function(){return this},change:function(f){f&&(f=a(f));if(!(f&&f.length&&f.is(":visible"))){return}var e=this,i=e._model.dldisable(f),k=e._model.dltarget(f),j=e._model.dldisplay(f),h=e._model.dlhidetarget(f);if(f.is("[dlhidetargetsub]")){var g=parentSelector(f,f.attr("dlhidetargetsub"));if(g&&g.length){if(f.prop("checked")){g.show()}else{g.hide()}}}if(k&&k.length){k.each(function(){var m=a(this);m.attr("disabled",i);JC.Valid&&JC.Valid.setValid(m);if(m.is("[dlhidetargetsub]")){var l=parentSelector(m,m.attr("dlhidetargetsub"));if(!(l&&l.length)){return}if(i){l.hide()}else{if(m.prop("checked")){l.show()}else{l.hide()}}}})}if(h&&h.length){h.each(function(){var l=e._model.dlhidetoggle(a(this))?!j:j;l?a(this).show():a(this).hide()})}i?a(e).trigger("TriggerEvent",["DisableItem",f]):a(e).trigger("TriggerEvent",["EnableItem",f]);a(e).trigger("TriggerEvent",["ChangeDone",f]);JC.log("DisableLogic view change",new Date().getTime(),i)}};a(document).ready(function(){setTimeout(function(){d.init()},10)})}(jQuery));