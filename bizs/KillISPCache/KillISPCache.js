(function(b){Bizs.KillISPCache=a;function a(c){if(a._instance){return a._instance}this._model=new a.Model(c);this._init()}a.prototype={_beforeInit:function(){JC.log("KillISPCache._beforeInit",new Date().getTime());this._model.processAjax()},process:function(d,e){d&&(d=b(d));if(!(d&&d.length)){return}var c=this;c._model.ignoreSameLinkText(e);c._model.selector(d);c._model.processLink();c._model.processForm();return this},ignoreUrl:function(c){return this._model.ignoreUrl(c)},ignoreSelector:function(c){return this._model.ignoreSelector(c)}};a.getInstance=function(){!a._instance&&(a._instance=new a());return a._instance};a.ignoreSameLinkText=true;a.randName="";a.ignoreUrl=function(c){return a.getInstance().ignoreUrl(c)};a.ignoreSelector=function(c){return a.getInstance().ignoreSelector(c)};JC.BaseMVC.buildModel(a);a.Model.prototype={init:function(){this._postfix=printf("{0}_{1}_",new Date().getTime().toString(),Math.round(Math.random()*100000));this._count=1;this._ignoreSameLinkText=true;this._randName="isp";this._ignoreUrl=[];this._ignoreSelector=[]},ignoreUrl:function(c){if(typeof c=="string"){c=c.split(",")}c&&c.length&&(this._ignoreUrl=this._ignoreUrl.concat(c));return this._ignoreUrl},ignoreSelector:function(c){if(typeof c=="string"){c=c.split(",")}c&&c.length&&(this._ignoreSelector=this._ignoreSelector.concat(c));return this._ignoreSelector},processLink:function(){var c=this;this.selector().find("a[href]").each(function(){var d=b(this),g=(d.attr("href")||"").trim(),h=d.html().trim();if(/javascript\:/.test(g)||/^[\s]*\#/.test(g)){return}if(c.ignoreSameLinkText()&&g.trim()==d.html().trim()){return}var f=c.ignoreSelector(),e=false;b.each(f,function(j,i){if(d.is(i)){e=true;return false}});if(e){return}g=addUrlParams(g,c.keyVal());d.attr("href",g);d.html(h)})},processForm:function(){var c=this;this.selector().find("form").each(function(){var d=b(this),f=(d.prop("method")||"").toLowerCase();if(f=="post"){return}var g=c.ignoreSelector(),e=false;b.each(g,function(i,h){if(d.is(h)){e=true;return false}});if(e){return}if(!d.find("input[name="+c.randName()+"]").length){b('<input type="hidden" name="'+c.randName()+'" value="'+c.postfix()+'" >').appendTo(d)}})},processAjax:function(){var c=this;b(document).ajaxSend(function(d,f,h){if(h.type=="POST"){return}var g=c.ignoreUrl(),e=false;b.each(g,function(l,k){var i=k.length,j=h.url.slice(0,i);if(k.toLowerCase()==j.toLowerCase()){e=true}});!e&&(h.url=addUrlParams(h.url,c.keyVal()))})},ignoreSameLinkText:function(c){typeof c!="undefined"&&(a.ignoreSameLinkText=c);return a.ignoreSameLinkText},postfix:function(){return this._postfix+(this._count++)},randName:function(){return a.randName||this._randName},keyVal:function(){var c={};c[this.randName()]=this.postfix();return c}};JC.BaseMVC.build(a,"Bizs");b(document).ready(function(){setTimeout(function(){a.autoInit&&a.getInstance().process(b(document))},100)})}(jQuery));