(function(c){Bizs.KillISPCache=d;function d(a){if(d._instance){return d._instance}this._model=new d.Model(a);this._init()}d.prototype={_beforeInit:function(){JC.log("KillISPCache._beforeInit",new Date().getTime());this._model.processAjax()},process:function(b,a){b&&(b=c(b));if(!(b&&b.length)){return}var f=this;f._model.ignoreSameLinkText(a);f._model.selector(b);f._model.processLink();f._model.processForm();return this},ignoreUrl:function(a){return this._model.ignoreUrl(a)},ignoreSelector:function(a){return this._model.ignoreSelector(a)}};d.getInstance=function(){!d._instance&&(d._instance=new d());return d._instance};d.ignoreSameLinkText=true;d.randName="";d.ignoreUrl=function(a){return d.getInstance().ignoreUrl(a)};d.ignoreSelector=function(a){return d.getInstance().ignoreSelector(a)};JC.BaseMVC.buildModel(d);d.Model.prototype={init:function(){this._postfix=printf("{0}_{1}_",new Date().getTime().toString(),Math.round(Math.random()*100000));this._count=1;this._ignoreSameLinkText=true;this._randName="isp";this._ignoreUrl=[];this._ignoreSelector=[]},ignoreUrl:function(a){if(typeof a=="string"){a=a.split(",")}a&&a.length&&(this._ignoreUrl=this._ignoreUrl.concat(a));return this._ignoreUrl},ignoreSelector:function(a){if(typeof a=="string"){a=a.split(",")}a&&a.length&&(this._ignoreSelector=this._ignoreSelector.concat(a));return this._ignoreSelector},processLink:function(){var a=this;this.selector().find("a[href]").each(function(){var l=c(this),i=(l.attr("href")||"").trim(),b=l.html().trim();if(/javascript\:/.test(i)||/^[\s]*\#/.test(i)){return}if(a.ignoreSameLinkText()&&i.trim()==l.html().trim()){return}var j=a.ignoreSelector(),k=false;c.each(j,function(e,f){if(l.is(f)){k=true;return false}});if(k){return}i=addUrlParams(i,a.keyVal());l.attr("href",i);l.html(b)})},processForm:function(){var a=this;this.selector().find("form").each(function(){var j=c(this),h=(j.prop("method")||"").toLowerCase();if(h=="post"){return}var b=a.ignoreSelector(),i=false;c.each(b,function(e,f){if(j.is(f)){i=true;return false}});if(i){return}if(!j.find("input[name="+a.randName()+"]").length){c('<input type="hidden" name="'+a.randName()+'" value="'+a.postfix()+'" >').appendTo(j)}})},processAjax:function(){var a=this;c(document).ajaxSend(function(l,j,b){if(b.type=="POST"){return}var i=a.ignoreUrl(),k=false;c.each(i,function(e,f){var h=f.length,g=b.url.slice(0,h);if(f.toLowerCase()==g.toLowerCase()){k=true}});!k&&(b.url=addUrlParams(b.url,a.keyVal()))})},ignoreSameLinkText:function(a){typeof a!="undefined"&&(d.ignoreSameLinkText=a);return d.ignoreSameLinkText},postfix:function(){return this._postfix+(this._count++)},randName:function(){return d.randName||this._randName},keyVal:function(){var a={};a[this.randName()]=this.postfix();return a}};JC.BaseMVC.build(d,"Bizs");c(document).ready(function(){setTimeout(function(){d.autoInit&&d.getInstance().process(c(document))},100)})}(jQuery));